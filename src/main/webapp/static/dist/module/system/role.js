define("module/system/role",["app/common","app/api","app/datatables","app/form","app/tree"],function(e,t,n,r){function s(n,r,i){var s=n.selectedRows()[0].id;e.showModal("pages/system/role/role-permissions","#system-role-permissions",{},function(){var n=$("#system-role-permissions-tree").tree({stmID:"cn.bx.system.mapper.RoleMapper.selectAllMenuTree",param:{roleId:s},check:{enable:!0},data:{simpleData:{pIdKey:"parent_id"}},queryTools:!0});$("#system-role-permissions .btn-primary").on("click",function(){var r=n.getCheckedNodes(!0),i=r.length;if(i>0){var o=new Array;for(var u=0;u<i;u++)o.push(r[u].id);t.ajax("ADMIN/system/role/menu/"+s,o,!0,function(t){e.success(t,"#system-role-permissions")})}else e.error("\u8bf7\u9009\u62e9\u9700\u8981\u6388\u6743\u7684\u83dc\u5355","#system-role-permissions")})})}function o(n,r,i){var s=n.selectedRows()[0].id;e.showModal("pages/system/role/role-assign","#system-role-assign",{},function(){var n=$("#system-role-assign-tree").tree({stmID:"cn.bx.system.mapper.RoleMapper.selectAllUserTree",param:{roleId:s},check:{enable:!0},data:{simpleData:{pIdKey:"parent_id"}},queryTools:!0,onNodeCreated:function(e,t,n){var r=$.fn.zTree.getZTreeObj(t);n.icons!="fa fa-user"&&r.getNodesByParam("icons","fa fa-user",n).length==0&&r.removeNode(n),n.checked&&r.checkNode(n,!0,!0)}},null,function(e){var t=e.getNodesByFilter(function(e){return e.level==0});for(var n=0;n<t.length;n++)e.getNodesByParam("checked",!0,t[n]).length>0&&e.expandNode(t[n],!0,!0,!0)});$("#system-role-assign .btn-primary").on("click",function(){var r=n.getCheckedNodes(!0),i=r.length;if(i>0){var o=new Array;for(var u=0;u<i;u++)r[u].icons=="fa fa-user"&&o.push(r[u].id);t.ajax("ADMIN/system/role/user/"+s,o,!0,function(t){e.success(t,"#system-role-assign",!0)})}else e.error("\u8bf7\u9009\u62e9\u9700\u8981\u5206\u914d\u7684\u7528\u6237","#system-role-assign")})})}function u(e){$("table#table-system-role-list").initTable({autoWidth:!0,columnDefs:i,permission:!0,deleteRecord:{url:"ADMIN/system/role/delete",id:"id"},addEditForm:{title:"\u89d2\u8272\u7ef4\u62a4",editModal:"#system-role-list-edit",id:"#system-role-edit-form",rules:{enname:{checkExists:{stmid:"cn.bx.system.mapper.RoleMapper.checkEnname"},messages:{checkExists:"\u5df2\u5b58\u5728\u8be5\u82f1\u6587\u540d\u79f0"}}}},permissionRole:s,assignRole:o},function(e){})}var i=[{targets:2,render:function(e){return t.getDictName("sys_role_type",e)}},{targets:3,render:function(e){return t.getDictName("sys_data_scope",e)}}];return{inti_table:u,init:function(e){this.inti_table(e)}}});