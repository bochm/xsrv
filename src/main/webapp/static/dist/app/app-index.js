define("app/digests",[],function(){function r(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;var n=1732584193,r=-271733879,i=-1732584194,f=271733878;for(var l=0;l<e.length;l+=16){var c=n,h=r,p=i,d=f;n=s(n,r,i,f,e[l+0],7,-680876936),f=s(f,n,r,i,e[l+1],12,-389564586),i=s(i,f,n,r,e[l+2],17,606105819),r=s(r,i,f,n,e[l+3],22,-1044525330),n=s(n,r,i,f,e[l+4],7,-176418897),f=s(f,n,r,i,e[l+5],12,1200080426),i=s(i,f,n,r,e[l+6],17,-1473231341),r=s(r,i,f,n,e[l+7],22,-45705983),n=s(n,r,i,f,e[l+8],7,1770035416),f=s(f,n,r,i,e[l+9],12,-1958414417),i=s(i,f,n,r,e[l+10],17,-42063),r=s(r,i,f,n,e[l+11],22,-1990404162),n=s(n,r,i,f,e[l+12],7,1804603682),f=s(f,n,r,i,e[l+13],12,-40341101),i=s(i,f,n,r,e[l+14],17,-1502002290),r=s(r,i,f,n,e[l+15],22,1236535329),n=o(n,r,i,f,e[l+1],5,-165796510),f=o(f,n,r,i,e[l+6],9,-1069501632),i=o(i,f,n,r,e[l+11],14,643717713),r=o(r,i,f,n,e[l+0],20,-373897302),n=o(n,r,i,f,e[l+5],5,-701558691),f=o(f,n,r,i,e[l+10],9,38016083),i=o(i,f,n,r,e[l+15],14,-660478335),r=o(r,i,f,n,e[l+4],20,-405537848),n=o(n,r,i,f,e[l+9],5,568446438),f=o(f,n,r,i,e[l+14],9,-1019803690),i=o(i,f,n,r,e[l+3],14,-187363961),r=o(r,i,f,n,e[l+8],20,1163531501),n=o(n,r,i,f,e[l+13],5,-1444681467),f=o(f,n,r,i,e[l+2],9,-51403784),i=o(i,f,n,r,e[l+7],14,1735328473),r=o(r,i,f,n,e[l+12],20,-1926607734),n=u(n,r,i,f,e[l+5],4,-378558),f=u(f,n,r,i,e[l+8],11,-2022574463),i=u(i,f,n,r,e[l+11],16,1839030562),r=u(r,i,f,n,e[l+14],23,-35309556),n=u(n,r,i,f,e[l+1],4,-1530992060),f=u(f,n,r,i,e[l+4],11,1272893353),i=u(i,f,n,r,e[l+7],16,-155497632),r=u(r,i,f,n,e[l+10],23,-1094730640),n=u(n,r,i,f,e[l+13],4,681279174),f=u(f,n,r,i,e[l+0],11,-358537222),i=u(i,f,n,r,e[l+3],16,-722521979),r=u(r,i,f,n,e[l+6],23,76029189),n=u(n,r,i,f,e[l+9],4,-640364487),f=u(f,n,r,i,e[l+12],11,-421815835),i=u(i,f,n,r,e[l+15],16,530742520),r=u(r,i,f,n,e[l+2],23,-995338651),n=a(n,r,i,f,e[l+0],6,-198630844),f=a(f,n,r,i,e[l+7],10,1126891415),i=a(i,f,n,r,e[l+14],15,-1416354905),r=a(r,i,f,n,e[l+5],21,-57434055),n=a(n,r,i,f,e[l+12],6,1700485571),f=a(f,n,r,i,e[l+3],10,-1894986606),i=a(i,f,n,r,e[l+10],15,-1051523),r=a(r,i,f,n,e[l+1],21,-2054922799),n=a(n,r,i,f,e[l+8],6,1873313359),f=a(f,n,r,i,e[l+15],10,-30611744),i=a(i,f,n,r,e[l+6],15,-1560198380),r=a(r,i,f,n,e[l+13],21,1309151649),n=a(n,r,i,f,e[l+4],6,-145523070),f=a(f,n,r,i,e[l+11],10,-1120210379),i=a(i,f,n,r,e[l+2],15,718787259),r=a(r,i,f,n,e[l+9],21,-343485551),n=q(n,c),r=q(r,h),i=q(i,p),f=q(f,d)}return Array(n,r,i,f)}function i(e,t,n,r,i,s){return q(l(q(q(t,e),q(r,s)),i),n)}function s(e,t,n,r,s,o,u){return i(t&n|~t&r,e,t,s,o,u)}function o(e,t,n,r,s,o,u){return i(t&r|n&~r,e,t,s,o,u)}function u(e,t,n,r,s,o,u){return i(t^n^r,e,t,s,o,u)}function a(e,t,n,r,s,o,u){return i(n^(t|~r),e,t,s,o,u)}function f(e,t){var i=c(e);i.length>16&&(i=r(i,e.length*n));var s=Array(16),o=Array(16);for(var u=0;u<16;u++)s[u]=i[u]^909522486,o[u]=i[u]^1549556828;var a=r(s.concat(c(t)),512+t.length*n);return r(o.concat(a),640)}function l(e,t){return e<<t|e>>>32-t}function c(e){var t=Array(),r=(1<<n)-1;for(var i=0;i<e.length*n;i+=n)t[i>>5]|=(e.charCodeAt(i/n)&r)<<i%32;return t}function h(e){var t="",r=(1<<n)-1;for(var i=0;i<e.length*32;i+=n)t+=String.fromCharCode(e[i>>5]>>>i%32&r);return t}function p(t){var n=e?"0123456789ABCDEF":"0123456789abcdef",r="";for(var i=0;i<t.length*4;i++)r+=n.charAt(t[i>>2]>>i%4*8+4&15)+n.charAt(t[i>>2]>>i%4*8&15);return r}function d(e){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="";for(var i=0;i<e.length*4;i+=3){var s=(e[i>>2]>>8*(i%4)&255)<<16|(e[i+1>>2]>>8*((i+1)%4)&255)<<8|e[i+2>>2]>>8*((i+2)%4)&255;for(var o=0;o<4;o++)i*8+o*6>e.length*32?r+=t:r+=n.charAt(s>>6*(3-o)&63)}return r}function v(){return hex_sha256("abc").toLowerCase()=="ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad"}function m(e){return N(I(T(e),e.length*8))}function g(e,t){var n=T(e);n.length>16&&(n=I(n,e.length*8));var r=Array(16),i=Array(16);for(var s=0;s<16;s++)r[s]=n[s]^909522486,i[s]=n[s]^1549556828;var o=I(r.concat(T(t)),512+t.length*8);return N(I(i.concat(o),768))}function y(t){try{e}catch(n){e=0}var r=e?"0123456789ABCDEF":"0123456789abcdef",i="",s;for(var o=0;o<t.length;o++)s=t.charCodeAt(o),i+=r.charAt(s>>>4&15)+r.charAt(s&15);return i}function b(e){try{t}catch(n){t=""}var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="",s=e.length;for(var o=0;o<s;o+=3){var u=e.charCodeAt(o)<<16|(o+1<s?e.charCodeAt(o+1)<<8:0)|(o+2<s?e.charCodeAt(o+2):0);for(var a=0;a<4;a++)o*8+a*6>e.length*8?i+=t:i+=r.charAt(u>>>6*(3-a)&63)}return i}function w(e,t){var n=t.length,r=Array(),i,s,o,u,a=Array(Math.ceil(e.length/2));for(i=0;i<a.length;i++)a[i]=e.charCodeAt(i*2)<<8|e.charCodeAt(i*2+1);while(a.length>0){u=Array(),o=0;for(i=0;i<a.length;i++){o=(o<<16)+a[i],s=Math.floor(o/n),o-=s*n;if(u.length>0||s>0)u[u.length]=s}r[r.length]=o,a=u}var f="";for(i=r.length-1;i>=0;i--)f+=t.charAt(r[i]);var l=Math.ceil(e.length*8/(Math.log(t.length)/Math.log(2)));for(i=f.length;i<l;i++)f=t[0]+f;return f}function E(e){var t="",n=-1,r,i;while(++n<e.length)r=e.charCodeAt(n),i=n+1<e.length?e.charCodeAt(n+1):0,55296<=r&&r<=56319&&56320<=i&&i<=57343&&(r=65536+((r&1023)<<10)+(i&1023),n++),r<=127?t+=String.fromCharCode(r):r<=2047?t+=String.fromCharCode(192|r>>>6&31,128|r&63):r<=65535?t+=String.fromCharCode(224|r>>>12&15,128|r>>>6&63,128|r&63):r<=2097151&&(t+=String.fromCharCode(240|r>>>18&7,128|r>>>12&63,128|r>>>6&63,128|r&63));return t}function S(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)&255,e.charCodeAt(n)>>>8&255);return t}function x(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)>>>8&255,e.charCodeAt(n)&255);return t}function T(e){var t=Array(e.length>>2);for(var n=0;n<t.length;n++)t[n]=0;for(var n=0;n<e.length*8;n+=8)t[n>>5]|=(e.charCodeAt(n/8)&255)<<24-n%32;return t}function N(e){var t="";for(var n=0;n<e.length*32;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function C(e,t){return e>>>t|e<<32-t}function k(e,t){return e>>>t}function L(e,t,n){return e&t^~e&n}function A(e,t,n){return e&t^e&n^t&n}function O(e){return C(e,2)^C(e,13)^C(e,22)}function M(e){return C(e,6)^C(e,11)^C(e,25)}function _(e){return C(e,7)^C(e,18)^k(e,3)}function D(e){return C(e,17)^C(e,19)^k(e,10)}function P(e){return C(e,28)^C(e,34)^C(e,39)}function H(e){return C(e,14)^C(e,18)^C(e,41)}function B(e){return C(e,1)^C(e,8)^k(e,7)}function j(e){return C(e,19)^C(e,61)^k(e,6)}function I(e,t){var n=new Array(1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225),r=new Array(64),i,s,o,u,a,f,l,c,h,p,d,v;e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;for(h=0;h<e.length;h+=16){i=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7];for(p=0;p<64;p++)p<16?r[p]=e[p+h]:r[p]=q(q(q(D(r[p-2]),r[p-7]),_(r[p-15])),r[p-16]),d=q(q(q(q(c,M(a)),L(a,f,l)),F[p]),r[p]),v=q(O(i),A(i,s,o)),c=l,l=f,f=a,a=q(u,d),u=o,o=s,s=i,i=q(d,v);n[0]=q(i,n[0]),n[1]=q(s,n[1]),n[2]=q(o,n[2]),n[3]=q(u,n[3]),n[4]=q(a,n[4]),n[5]=q(f,n[5]),n[6]=q(l,n[6]),n[7]=q(c,n[7])}return n}function q(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}var e=0,t="",n=8,F=new Array(1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998),R={};return R.hex_sha256=function(e){return y(m(E(e)))},R.b64_sha256=function(e){return b(m(E(e)))},R.any_sha256=function(e,t){return w(m(E(e)),t)},R.hex_hmac_sha256=function(e,t){return y(g(E(e),E(t)))},R.b64_hmac_sha256=function(e,t){return b(g(E(e),E(t)))},R.any_hmac_sha256=function(e,t,n){return w(g(E(e),E(t)),n)},R.hex_md5=function(e){return p(r(c(e),e.length*n))},R.b64_md5=function(e){return d(r(c(e),e.length*n))},R.str_md5=function(e){return h(r(c(e),e.length*n))},R.hex_hmac_md5=function(e,t){return p(f(e,t))},R.b64_hmac_md5=function(e,t){return d(f(e,t))},R.str_hmac_md5=function(e,t){return h(f(e,t))},R}),define("app/servers",["jquery","app/digests"],function(e,t){var n={KEY:"ADMIN",isLocalData:!1,localUserName:"localuser",fileParamName:"file",useLoginForm:!0,AUTH:{rpToken:"rp_token",userName:"loginname",pwd:"password",usToken:"rsToken",loginParam:{}},loginUrl:function(e){return"login"},userUrl:function(e){return this.KEY+"/login"},createHeader:function(e,n,r,i){return e==null||e==undefined||e[this.AUTH.usToken]==null?(typeof i=="function"&&i.call(this,_CONFIG.HTTP.UNAUTHORIZED),!1):(r.setRequestHeader(this.AUTH.userName,e[this.AUTH.userName]),r.setRequestHeader(this.AUTH.rpToken,t.hex_hmac_sha256(e[this.AUTH.usToken],encodeURI(n))),!0)},createLoginHeader:function(e,t){return e.setRequestHeader(this.AUTH.userName,t.find("input[data-role='username']").val()),e.setRequestHeader(this.AUTH.pwd,t.find("input[data-role='password']").val()),!0},resp:function(e){return e},respFile:function(t){var n={};n[_CONFIG.KEYS.STATUS]=t.status,n[_CONFIG.KEYS.MSG]=t.message;if(t.data!==undefined)if(e.isArray(t.data)){n[_CONFIG.KEYS.DATA]=new Array;for(var r=0;r<t.data.length;r++){var i={};i[_CONFIG.KEYS.FILE_ID]=t.data[r].id,i[_CONFIG.KEYS.FILE_NAME]=t.data[r].name,i[_CONFIG.KEYS.FILE_URL]=t.data[r].path,i[_CONFIG.KEYS.FILE_TYPE]=t.data[r].type,i[_CONFIG.KEYS.FILE_OWNER]=t.data[r].ownerid,n[_CONFIG.KEYS.DATA].push(i)}}else n[_CONFIG.KEYS.DATA]={},n[_CONFIG.KEYS.DATA][_CONFIG.KEYS.FILE_ID]=t.data.id,n[_CONFIG.KEYS.DATA][_CONFIG.KEYS.FILE_NAME]=t.data.name,n[_CONFIG.KEYS.DATA][_CONFIG.KEYS.FILE_URL]=t.data.path,n[_CONFIG.KEYS.DATA][_CONFIG.KEYS.FILE_TYPE]=t.data.type,n[_CONFIG.KEYS.DATA][_CONFIG.KEYS.FILE_OWNER]=t.data.ownerid;return n},getUrl:function(e){return e.indexOf(this.KEY)==0?this.ctx+e.substr(this.KEY.length+1,e.length)+this.SUFFIX:this.ctx+e+this.SUFFIX},getFileUploadUrl:function(e){return"ADMIN/system/file/upload/"+e.ownerid+"/"+e.type},getFileDropUrl:function(e){return e!=undefined&&e!=null?"ADMIN/system/file/drop/"+e.id:"ADMIN/system/file/drop"},getFileListUrl:function(e){return e!=undefined&&e!=null?"ADMIN/system/file/list/"+e.ownerid+"/"+e.type:"ADMIN/system/file/list"},getFileListParam:function(e){return e!=undefined&&e!=null?e:{}},SUFFIX:""},r={ADMIN:n,WEIXIN:e.extend(!0,{},n,{KEY:"WEIXIN",useLoginForm:!0,AUTH:{rpToken:"authToken",userName:"userCode",pwd:"password",usToken:"authToken"},loginUrl:function(e){return"login.do"},createLoginHeader:function(e,t){return e.setRequestHeader("userCode",t.find("input[data-role='username']").val()),e.setRequestHeader("password",t.find("input[data-role='password']").val()),!0},resp:function(e){return e[_CONFIG.KEYS.STATUS]=e.code,e},respFile:function(t){var n={};n[_CONFIG.KEYS.STATUS]=t.code,n[_CONFIG.KEYS.MSG]=t.message;if(t.data!==undefined)if(e.isArray(t.data)){n[_CONFIG.KEYS.DATA]=new Array;for(var r=0;r<t.data.length;r++){var i={};i[_CONFIG.KEYS.FILE_ID]=t.data[r].id,i[_CONFIG.KEYS.FILE_NAME]=t.data[r].attachName,i[_CONFIG.KEYS.FILE_URL]=t.data[r].attachPath,i[_CONFIG.KEYS.FILE_TYPE]=t.data[r].attachType,i[_CONFIG.KEYS.FILE_OWNER]=t.data[r].ownerId,n[_CONFIG.KEYS.DATA].push(i)}}else n[_CONFIG.KEYS.DATA]={},n[_CONFIG.KEYS.DATA][_CONFIG.KEYS.FILE_ID]=t.data.id,n[_CONFIG.KEYS.DATA][_CONFIG.KEYS.FILE_NAME]=t.data.attachName,n[_CONFIG.KEYS.DATA][_CONFIG.KEYS.FILE_URL]=t.data.attachPath,n[_CONFIG.KEYS.DATA][_CONFIG.KEYS.FILE_TYPE]=t.data.attachType,n[_CONFIG.KEYS.DATA][_CONFIG.KEYS.FILE_OWNER]=t.data.ownerId;return n},getFileUploadUrl:function(e){return"WEIXIN/attachment/upload/"+e.ownerid+"/"+e.type},getFileDropUrl:function(e){return e!=undefined&&e!=null?"WEIXIN/attachment/delete/"+e.id:"WEIXIN/attachment/deleteByPath"},getFileListUrl:function(e){return e!=undefined&&e!=null?"WEIXIN/attachment/list/"+e.ownerid+"/"+e.type:"WEIXIN/attachment/listByPath"},SUFFIX:".do"}),DEFAULT:{}};for(var i=0;i<_CONFIG.SERVERS.LIST.length;i++)r[_CONFIG.SERVERS.LIST[i]].fileSrvUrl=_CONFIG.SERVERS[_CONFIG.SERVERS.LIST[i]].fileSrvUrl,r[_CONFIG.SERVERS.LIST[i]].srvUrl=_CONFIG.SERVERS[_CONFIG.SERVERS.LIST[i]].srvUrl,r[_CONFIG.SERVERS.LIST[i]].ctx=_CONFIG.SERVERS[_CONFIG.SERVERS.LIST[i]].ctx;for(var i=0;i<_CONFIG.SERVERS.LOCAL_DATA.length;i++)r[_CONFIG.SERVERS.LOCAL_DATA[i]].isLocalData=!0,r[_CONFIG.SERVERS.LOCAL_DATA[i]].srvUrl=_CONFIG.localDataUrl,r[_CONFIG.SERVERS.LOCAL_DATA[i]].ctx="";return r.DEFAULT=r[_CONFIG.SERVERS.DEFAULT],r}),define("app/api",["jquery","store","app/servers"],function(e,t,n){function s(t,n){require(["jquery/gritter"],function(){e.gritter.add({text:n,title:t,sticky:!1,time:"5000",class_name:"gritter-error"})})}function o(e){return API.getLocalData((e||n.DEFAULT.KEY)+r)}function u(e,t){API.setLocalData((t||n.DEFAULT.KEY)+r,e)}function a(t){try{var r=t.substring(0,t.indexOf("/")),i=e.inArray(r,_CONFIG.SERVERS.LIST);if(i>-1)return n[_CONFIG.SERVERS.LIST[i]]}catch(s){console.error("server\u672a\u627e\u5230",s)}return n.DEFAULT}function f(e,t,n,r){return e.isLocalData?!0:e.createHeader(o(e.KEY),t,n,r)}function l(e,t,n){return a(n).createLoginHeader(e,t)}function c(t,n,r,i,o,a,f){e.ajax({type:"POST",url:t.srvUrl+t.ctx+t.loginUrl(),contentType:"application/json;charset=utf-8",data:JSON.stringify(t.loginParam||{}),dataType:"json",async:!1,beforeSend:function(n){return t.createLoginHeader(n,e("form.login-form"))},success:function(e,s){var l=t.resp(e);if(API.isError(l))API.defaultError(l);else{var c=API.respData(l);c!=null&&c!=undefined?(u(c,t.KEY),n!=undefined&&n!=null?d(n,i,o,a,f):r!=undefined&&r!=null&&r.submit()):API.defaultError(l)}},error:function(t,n,r){console.error(t),s("\u7cfb\u7edf\u9519\u8bef["+t[API.STATUS]+"]","\u670d\u52a1\u7f51\u7edc\u5f02\u5e38!!"),e(".blockUI").remove()}})}function h(t,n,r,i,o){require(["bootstrap","app/form"],function(){e("#sys-login").length>0?(e("#sys-login").modal("show"),p(t,n,r,i,o)):e.ajax({type:"GET",cache:!1,url:"login-pop.html",dataType:"html",async:!1,success:function(s){e("body").append(s),e("#sys-login").modal("show"),p(t,n,r,i,o)},error:function(t,n,r){s("\u767b\u9646\u9875\u9762\u52a0\u8f7d\u9519\u8bef["+t.status+"]",t.statusText),e(".blockUI").remove()}})})}function p(t,n,r,i,s){var u=a(t),f=o(u.KEY);f!=null&&f!=undefined&&(document.forms["login-form"].loginname.value=f[u.AUTH.userName]);var l=u.KEY+"/"+u.loginUrl();e("form.login-form").initForm({url:l,beforeSend:function(t){return u.createLoginHeader(t,e("form.login-form"))},rules:{loginname:{messages:{required:"\u8bf7\u8f93\u5165\u7528\u6237\u540d"}},password:{messages:{required:"\u8bf7\u8f93\u5165\u5bc6\u7801"}}},beforeSubmit:function(t,n,r){return e(".login-form .alert-danger").remove(),e(".login-form button[type='submit']").attr("disabled","true").text("\u767b\u5f55\u4e2d.."),!0},success:function(o,a){e(".login-form button[type='submit']").removeAttr("disabled").text("\u767b\u5f55");var f=u.resp(o);API.isError(f)?e(".login-form").prepend("<div class='alert alert-danger'><button class='close' type='button' data-dismiss='alert'>\u00d7</button><span></span>"+API.respMsg(f)+"</div>"):(API.storeUser(API.respData(f),u.KEY),e("#sys-login").modal("hide"),t!=undefined&&t!=null?d(t,n,r,i,s):typeof i=="function"&&i.call(this,API.respData(f)))},error:function(t){e(".login-form button[type='submit']").removeAttr("disabled").text("\u767b\u5f55"),e(".login-form").prepend("<div class='alert alert-danger'><button class='close' type='button' data-dismiss='alert'>\u00d7</button><span></span>\u7cfb\u7edf\u9519\u8bef\uff0c\u65e0\u6cd5\u8fde\u63a5\u670d\u52a1\u5668</div>")}})}function d(t,n,r,i,o,u){var l=a(t),p=l.getUrl(t),d=o||API.defaultError;if(l.isLocalData)return API.localData(l.srvUrl+t,r,i,d);var v=!0;r!=undefined&&r!=null&&(v=r);var m;return e.ajax({type:"POST",url:l.srvUrl+p,contentType:"application/json;charset=utf-8",data:JSON.stringify(n),async:v,dataType:"json",beforeSend:function(e){return f(l,p,e,function(e){l.useLoginForm?h(t,n,r,i,d):c(l,t,null,n,r,i,d)})},success:function(e,o){var a=l.resp(e);if(API.isError(a)){if(API.isUnAuthorized(a)&&u===undefined){l.useLoginForm?h(t,n,r,i,d):c(l,t,null,n,r,i,d);return}API.isForbidden(a)&&s("\u672a\u6388\u6743","\u7981\u6b62\u8bbf\u95ee!!"),d(a)}else typeof i=="function"?i.call(this,a):m=a},error:function(t,n,r){console.error(t),s("\u7cfb\u7edf\u9519\u8bef["+t[API.STATUS]+"]","\u670d\u52a1\u7f51\u7edc\u5f02\u5e38!!"),e(".blockUI").remove()}}),m}e.support.cors=!0;var r="_LOCAL_USER_",i="_DICT_CODE_";"API"in window||(window.API={dict:{},DATA:_CONFIG.KEYS.DATA,MSG:_CONFIG.KEYS.MSG,STATUS:_CONFIG.KEYS.STATUS,OK:_CONFIG.KEYS.OK,FAIL:_CONFIG.KEYS.FAIL,ERROR:_CONFIG.KEYS.ERROR,WORN:_CONFIG.KEYS.WORN,EXCEPTION:_CONFIG.KEYS.EXCEPTION,CODE:_CONFIG.KEYS.CODE,urls:_CONFIG.URLS,defaultError:function(e){s("\u7cfb\u7edf\u9519\u8bef["+e[API.STATUS]+"]",e[API.MSG])},getLocalData:function(e,n){var r=t.get(e);if(typeof n!="function")return r;n.call(this,r)},setLocalData:function(e,n){t.set(e,n)},clearLocalData:function(){t.clearAll()},removeLocalData:function(e){t.remove(e)},logout:function(){t.remove(r);if(e.isArray(_CONFIG.SERVERS.LIST))for(var n=0;n<_CONFIG.SERVERS.LIST.length;n++)t.remove(_CONFIG.SERVERS.LIST[n]+r)},isForbidden:function(e){return e[API.STATUS]===undefined?!1:e[API.STATUS]==_CONFIG.HTTP.FORBIDDEN.status},isUnAuthorized:function(e){return e[API.STATUS]===undefined?!1:e[API.STATUS]==_CONFIG.HTTP.UNAUTHORIZED.status},isError:function(e){return e[API.STATUS]===undefined?!1:e[API.STATUS]!==_CONFIG.HTTP.OK.status},respData:function(e){return e[API.DATA]},respMsg:function(e){return e[API.MSG]},getServerByKey:function(e){return n[e]||n.DEFAULT},createHeader:f,ajax:d,localUser:o,storeUser:u,showLogin:h,createLoginHeader:l,getServerByUrl:a,backLogin:c}),API.jsonData=function(e,t,n){var r;d(e,t||{},!1,function(e){r=API.respData(e),typeof n=="function"&&n.call(this,r)});if(n===undefined)return r},API.getLoginUser=function(e,t){var r=n.DEFAULT;if(r.isLocalData)return d(r.userUrl(),{},!0,function(t){var n=r.resp(t),i=API.respData(n);u(i,r.KEY),typeof e=="function"&&e(i)},function(e,n){typeof t=="function"&&t.call(this,e,n)},!0);var i=o(r.KEY);return i==null||i==undefined?(typeof t=="function"&&t(_CONFIG.HTTP.UNAUTHORIZED),null):d(r.userUrl(i),{},!0,function(t){var n=r.resp(t),i=API.respData(n);u(i,r.KEY),typeof e=="function"&&e.call(this,i)},function(e,n){typeof t=="function"&&t.call(this,e,n)},!0)},API.getMapByStmId=function(e,t){return API.jsonData(_CONFIG.URLS.stmMapUrl+"/"+e+_CONFIG.HTTP.SUFFIX,t)},API.getListByStmId=function(e,t){return API.jsonData(_CONFIG.URLS.stmListUrl+"/"+e+_CONFIG.HTTP.SUFFIX,t)},API.getMapListByStmId=function(e,t){return API.jsonData(_CONFIG.URLS.stmMapListUrl+"/"+e+_CONFIG.HTTP.SUFFIX,t)},API.getDictByType=function(t){var n=API.getLocalData(i);if(n==null||n==undefined)n={};if(n[t]==null||n[t]==undefined)n[t]=API.jsonData(API.urls.dictUrl+t),e.isArray(n[t])&&n[t].length>0&&API.setLocalData(i,n);return n[t]},API.getDictMap=function(t){var n=API.getDictByType(t),r={};if(e.isArray(n))for(var i=0;i<n.length;i++)r[n[i].value]=n[i].name;return r},API.getDictName=function(e,t){var n=API.getDictMap(e);return n[t]?n[t]:""},API.localData=function(t,n,r,i){var o;return e.ajax({url:t.indexOf(".json")!=t.length-5?t+".json":t,contentType:"application/json;charset=utf-8",async:n?n:!1,cache:!1,success:function(e,t){o=e,typeof r=="function"&&r.call(this,e)},error:function(e,n,r){console.error(e),s("\u7cfb\u7edf\u5f02\u5e38",t+"\u6570\u636e\u4e0d\u5b58\u5728")}}),o},API.getPermission=function(e,t){var n=a(_CONFIG.URLS.permissionUrl);if(n.isLocalData)t.call(this,null,!0);else{var r=o(n.KEY);r==null||r==undefined?h(null,null,null,null,function(n){API.jsonData(_CONFIG.URLS.permissionUrl+n.id+"/"+e,{},function(e){t.call(this,e,!1)})}):API.jsonData(_CONFIG.URLS.permissionUrl+r.id+"/"+e,{},function(e){t.call(this,e,!1)})}},API.uploadFile=function(t,n,r,i,s){if(t.isLocalData)i.call(this,null);else{var o=t.getFileUploadUrl(r||{}),u=t.getUrl(o),a=s||API.defaultError;e.ajax({data:n,type:"POST",url:t.srvUrl+u,cache:!1,dataType:"json",processData:!1,async:!1,contentType:!1,beforeSend:function(e){return API.createHeader(t,u,e,a)},success:function(e){var n=t.respFile(e);if(API.isError(n))a.call(this,n);else{var r=API.respData(n);typeof i=="function"&&i.call(this,r)}},error:function(e,t,n){console.error(e),a.call(this,e)}})}};if(n.DEFAULT.isLocalData){var v=API.jsonData(n.DEFAULT.KEY+"/dict-map");API.setLocalData(i,v)}return API}),define("app/common",["jquery","app/api","numeral","bootstrap","moment","jquery/blockui","css!lib/bootstrap/bootstrap.css","css!lib/font-awesome/font-awesome.css","css!app/main.css"],function(e,t){function u(e){return o.indexOf(e)!==-1}function a(t,n,r,i){APP.initTab(t,!1),APP.initPopover(t),APP.initTooltip(t),APP.initPulsate(t),APP.initPortletPanel(t),APP.initDropdowns(t),APP.initScroll(".scroller",t),APP.initSwitch(t),APP.initImagebox(t),t.find(".btn[data-submit]").each(function(){var t=e(this);t.click(function(){e(t.data("submit")).submit()})}),(APP.isIE8||APP.isIE9)&&t.find("input[placeholder]:not(.placeholder-no-fix), textarea[placeholder]:not(.placeholder-no-fix)").each(function(){var t=e(this);t.val()==""&&t.attr("placeholder")!=""&&t.addClass("placeholder").val(t.attr("placeholder")),t.focus(function(){t.val()==t.attr("placeholder")&&t.val("")}),t.blur(function(){(t.val()==""||t.val()==t.attr("placeholder"))&&t.val(t.attr("placeholder"))})}),r&&(t.hasClass("inner")?e(r).after(t):(APP.unblockUI(r),e(r).children().each(function(){e(this).attr("id")!="topcontrol"&&e(this).remove()}),e(r).append(t)),typeof i=="function"&&i.call(this,t),f(t,n),t.hasClass("inner")?e(r).fadeOut(function(){t.fadeIn()}):t.fadeIn("slow"))}function f(e,t){e.data("js-module")&&(requirejs.undef(e.data("js-module")),require([e.data("js-module")],function(n){e.data("js-main")?n[e.data("js-main")].call(this,t):n.init(t)}))}function l(t){if(APP.isEmpty(t))return e("body");if(t instanceof e&&t.length>0)return t;var n=e(t);return n.length>0?n:e("body")}function c(e){APP.notice("\u7cfb\u7edf\u9519\u8bef",e,"error")}function h(t){var n=t.children("div.portlet-title"),r=t.children("div.portlet-body");n.on("click","a.expand",function(t){t.preventDefault(),e(this).hasClass("cls")?(e(this).removeClass("cls"),r.slideDown(200)):(e(this).addClass("cls"),r.slideUp(200))}),n.on("click","a.fullscreen",function(n){n.preventDefault();if(t.hasClass("portlet-fullscreen"))e(this).removeClass("on"),t.removeClass("portlet-fullscreen"),e("body").removeClass("page-portlet-fullscreen"),t.children(".portlet-body").css("height","auto"),e(this).siblings("a.expand,a.close").removeClass("hide");else{var r=APP.getViewPort().height-t.children(".portlet-title").outerHeight()-parseInt(t.children(".portlet-body").css("padding-top"))-parseInt(t.children(".portlet-body").css("padding-bottom"));e(this).addClass("on"),t.addClass("portlet-fullscreen"),e("body").addClass("page-portlet-fullscreen"),t.children(".portlet-body").css("height",r),e(this).siblings("a.expand,a.close").addClass("hide")}}),n.on("click","a.reload",function(e){e.preventDefault(),APP.loadPortlet(t)}),n.on("click","a.remove",function(e){e.preventDefault(),APP.removePortlet(t)})}function p(t,n){var r=e("<button type='button' class='btn' data-action='true'>"+(t.text?t.text:"")+"</button>");return t.classes&&r.addClass(t.classes),t.attr&&r.attr(t.attr),typeof t.action=="function"&&r.on("click",function(e){t.action.call(this,e,r,n)}),r}function d(t,n,r){var i=t.children(".modal-footer");r&&i.children("[data-action]").remove();if(n.buttons)if(e.isArray(n.buttons))for(var s=0;s<n.buttons.length;s++)i.append(p(n.buttons[s],t));else i.append(p(n.buttons,t))}function v(t,n,r,i){e.ajax({type:"GET",cache:!1,url:t.indexOf("?")>0?t.split("?")[0]+".html?"+t.split("?")[1]:t+".html",dataType:"html",success:function(i){APP.currentUrl=t;var s=e(i).filter(".modal");APP.initComponents(s),e("body").append(s),typeof r=="function"&&r.call(this),f(s,n)},error:function(e,t,n){typeof i=="function"?i.call(this,e,e.status):c("\u9875\u9762\u52a0\u8f7d\u9519\u8bef:\u72b6\u6001["+e.status+"]\u9519\u8bef["+e.statusText+"]")}})}function m(t,n){var r=e(t);r.attr({tabindex:"-1","data-focus-on":"input:first"}).css("display","none"),r.children(".modal-body").length==0&&r.children().wrapAll("<div class='modal-body'></div>"),r.children(".modal-header").length==0?r.prepend("<div class='modal-header'><button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button><h4 class='modal-title'>"+n.title+"</h4></div>"):n.title!=""&&r.find(".modal-title").html(n.title);if(n.hasFooter){r.children(".modal-footer").length==0&&r.append("<div class='modal-footer'><button type='button' class='btn btn-default' data-dismiss='modal'>\u5173\u95ed</button></div>");var i=r.children(".modal-footer");i.children("[data-action]").remove();if(n.buttons)if(e.isArray(n.buttons))for(var s=0;s<n.buttons.length;s++)i.append(p(n.buttons[s],r));else i.append(p(n.buttons,r))}}function g(t){function u(){var o=r-i;o<.1&&o>-0.1?(a(i),s=0,r===100&&(n.style.height=0,setTimeout(function(){e(n).remove(),e(t).remove()},300))):(a(r-o/4),setTimeout(f,16))}function a(e){r=e,n.style.width=r+"%"}function f(e){e>=0?(i=e,s||(s=1,u())):s&&u()}var n=document.createElement("div"),r=0,i=0,s=0,o={el:n,go:f};return e(n).css({width:0,height:"100%",transition:"height .3s",background:"#66afe9"}),o}var n={blue:"#89C4F4",red:"#F3565D",green:"#1bbc9b",purple:"#9b59b6",grey:"#95a5a6",yellow:"#F8CB00"};e.fn.modal.Constructor.prototype.enforceFocus=function(){},e.fn.modal.defaults.spinner=e.fn.modalmanager.defaults.spinner='<div class="loading-spinner" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="progress-bar progress-bar-info" style="width: 100%;"><span class="sr-only"> \u9875\u9762\u52a0\u8f7d\u4e2d</span>\u9875\u9762\u52a0\u8f7d\u4e2d</div></div></div>';var r=require("moment");r.locale("zh-cn");var i=require("numeral");i.locale("chs");var s={},o=window.navigator.userAgent.toLowerCase();return s.ios=function(){return s.iphone()||s.ipod()||s.ipad()},s.iphone=function(){return!s.windows()&&u("iphone")},s.ipod=function(){return u("ipod")},s.ipad=function(){return u("ipad")},s.android=function(){return!s.windows()&&u("android")},s.androidPhone=function(){return s.android()&&u("mobile")},s.androidTablet=function(){return s.android()&&!u("mobile")},s.windows=function(){return u("windows")},s.windowsPhone=function(){return s.windows()&&u("phone")},s.windowsTablet=function(){return s.windows()&&u("touch")&&!s.windowsPhone()},"APP"in window||(window.APP={isIE8:!1,isIE9:!1,isIE10:!1,isRTL:!1,debug:_CONFIG.debug,device:s,isMobile:s.androidPhone()||s.iphone()||s.ipod()||s.windowsPhone(),isTablet:s.ipad()||s.androidTablet()||s.windowsTablet(),currentUrl:"index",pageContainer:_CONFIG.pageContainer,getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(APP.currentUrl);return n==null?"":decodeURIComponent(n[1].replace(/\+/g," "))},getURLParameter:function(e){var t=window.location.search.substring(1),n,r,i=t.split("&");for(n=0;n<i.length;n++){r=i[n].split("=");if(r[0]==e)return unescape(r[1])}return null},getPageContainer:function(e){return l(e).closest(APP.pageContainer).get()},getViewPort:function(){var e=window,t="inner";return"innerWidth"in window||(t="client",e=document.documentElement||document.body),{width:e[t+"Width"],height:e[t+"Height"]}},log:function(e){_CONFIG.debug&&console.log(e)},getUniqueID:function(e){return(e||"app_")+Math.floor(Math.random()*(new Date).getTime())},isEmpty:function(t){return!e.isNumeric(t)&&e.isEmptyObject(t)||e.trim(t)===""},jsPath:_CONFIG.jsBaseUrl,imgPath:_CONFIG.imgBaseUrl,queryContainer:l,formatDate:function(e,t,n){var i=APP.isEmpty(e)?"YYYYMMDD":e;return this.isEmpty(t)?r().format(i):this.isEmpty(n)?r(t).format(i):r(t,n).format(i)},numeral:i,loadPage:function(t,n,r,i,s){n&&(APP.blockUI({target:t,message:"\u9875\u9762\u52a0\u8f7d\u4e2d"}),e.ajax({type:"GET",cache:!1,url:n.indexOf("?")>0?n.split("?")[0]+".html?"+n.split("?")[1]:n+".html",dataType:"html",success:function(s){APP.currentUrl=n,APP.initComponents(e(s),r,t,i)},error:function(e,n,r){APP.unblockUI(t),typeof s=="function"?s.call(this,e,e.status):c("\u9875\u9762\u52a0\u8f7d\u9519\u8bef:\u72b6\u6001["+e.status+"]\u9519\u8bef["+e.statusText+"]")}}))},loadInnerPage:function(t,n,r,i,s){n&&e.ajax({type:"GET",cache:!1,url:n.indexOf("?")>0?n.split("?")[0]+".html?"+n.split("?")[1]:n+".html",dataType:"html",success:function(n){var s=e(n);s.find("[data-page-return='true']").length==0&&s.prepend("<a class='btn btn-circle btn-icon-only blue return-page' data-page-return='true'> \u8fd4\u56de </a>"),s.on("click","[data-page-return='true']",function(){s.fadeOut(function(){e(t).fadeIn(),e(t).find("table.datatable").resize(),s.remove()})}),APP.initComponents(s,r,t,i)},error:function(e,t,n){typeof s=="function"?s(e,e.status):c("\u9875\u9762\u52a0\u8f7d\u9519\u8bef:\u72b6\u6001["+e.status+"]\u9519\u8bef["+e.statusText+"]")}})},returnPage:function(e){l(e).closest(APP.pageContainer).find("[data-page-return='true']").click()},getResponsiveBreakpoint:function(e){var t={xs:480,sm:768,md:900,lg:1200};return t[e]?t[e]:0},getColor:function(e){return n[e]?n[e]:""},scrollTo:function(t,n){var r=t&&t.size()>0?t.offset().top:0;t&&(e("body").hasClass("page-header-fixed")&&(r-=e(".page-header").height()),r+=n?n:-1*t.height()),e("html,body").animate({scrollTop:r},"slow")},disableBtn:function(e){if(e.length==0)return;e.hasClass("disabled")||e.addClass("disabled"),e.attr("disabled","disabled")},enableBtn:function(e){if(e.length==0)return;e.hasClass("disabled")&&e.removeClass("disabled"),e.removeAttr("disabled")},initScroll:function(t,n){var r=l(n).find(t);if(r.length==0)return;require(["jquery/scrollbar"],function(){r.each(function(){if(e(this).attr("data-scrolled"))return;APP.isEmpty(e(this).data("scroll-height"))&&e(this).attr("data-scroll-height",APP.getViewPort().height*.65),e(this).slimScroll({allowPageScroll:!0,size:"7px",color:e(this).attr("data-scroll-color")?e(this).attr("data-scroll-color"):"#bbb",wrapperClass:e(this).attr("data-scroll-wrapper")?e(this).attr("data-scroll-wrapper"):"slimScrollDiv",railColor:e(this).attr("data-scroll-railcolor")?e(this).attr("data-scroll-railcolor"):"#eaeaea",position:APP.isRTL?"left":"right",height:e(this).attr("data-scroll-height")?e(this).attr("data-scroll-height"):e(this).css("height"),alwaysVisible:e(this).attr("data-scroll-alwaysvisible")=="1"?!0:!1,railVisible:e(this).attr("data-scroll-railvisible")=="1"?!0:!1,disableFadeOut:!0}),e(this).attr("data-scrolled","1")})})},destroyScroll:function(t){var n=e(t);if(n.length==0)return;require(["jquery/scrollbar"],function(){n.each(function(){e(this).attr("data-scrolled")==="1"&&(e(this).removeAttr("data-scrolled"),e(this).removeAttr("style"),e(this).slimScroll({wrapperClass:e(this).attr("data-scroll-wrapper")?e(this).attr("data-scroll-wrapper"):"slimScrollDiv",destroy:!0}))})})},initTab:function(t,n,r,i){var s=l(t).find('a[data-toggle="tab"]');if(s.length==0)return;s.data("show","0"),s.on("show.bs.tab",function(t){var i=e(t.target);if(APP.isEmpty(i.data("url")))return;if(i.data("show")==="1")return;APP.loadPage(i.attr("href"),i.data("url"),r||{}),n?i.data("show","0"):i.data("show","1")});var o=s.parent("li.active").index(),u=o==-1?0:o;i!==undefined&&(u=i),APP.isEmpty(s.eq(u).data("url"))||(s.eq(u).parent("li").removeClass("active"),setTimeout(function(){s.eq(u).tab("show")},100))},initTooltip:function(e){l(e).find(".tooltips").tooltip()},initPopover:function(e){l(e).find(".popovers").popover()},initPulsate:function(t){var n=l(t).find("div.pulsate");if(n.length==0)return;require(["jquery/pulsate"],function(){n.each(function(){var t=e(this);t.pulsate({color:t.attr("pulsate-color")?t.attr("pulsate-color"):"#C43C35",reach:20,speed:1e3,pause:0,glow:!0,repeat:!0,onHover:t.attr("pulsate-hover")})})})},initSwitch:function(n){var r=l(n).find(".bs-switch");if(r.length==0)return;require(["switch"],function(){r.each(function(){var n=e(this);n.bootstrapSwitch("destroy");if(n.data("dict-type")){var r=t.getDictByType(n.data("dict-type"));e.isArray(r)&&r.length==2&&(n.data("on-value")!==undefined?(n.data("on-value")==r[0].value&&(n.data("on-text",r[0].name),n.data("off-value",r[1].value),n.data("off-text",r[1].name)),n.data("on-value")==r[1].value&&(n.data("on-text",r[1].name),n.data("off-value",r[0].value),n.data("off-text",r[0].name))):(n.data("on-value",r[0].value),n.data("on-text",r[0].name),n.data("off-value",r[1].value),n.data("off-text",r[1].name)))}n.bootstrapSwitch({state:n.is(":checked"),onSwitchChange:function(e,t){t?n.val(n.data("on-value")!==undefined?n.data("on-value")+"":"1"):n.val(n.data("off-value")!==undefined?n.data("off-value")+"":"0")},onInit:function(e,t){t?n.val(n.data("on-value")!==undefined?n.data("on-value")+"":"1"):n.val(n.data("off-value")!==undefined?n.data("off-value")+"":"0")}})})})},initComponents:function(n,r,i,s){var o=n.data("permission");o?t.getPermission(o,function(t,u){u||n.find("[data-permission]").each(function(){var n=e(this).data("permission");e.inArray(o+":"+n,t)===-1&&e(this).remove()}),a(n,r,i,s)}):a(n,r,i,s)}}),APP.loadPortlet=function(t,n,r){var i=t.children("div.portlet-body");i.length==0&&(i=e("<div class='portlet-body'>"),t.append(i)),t.attr("data-url")&&APP.loadPage(i.get(0),t.attr("data-url"),n,r)},APP.setPortletTitle=function(e,t){e.find("span.caption-subject").html(t)},APP.removePortlet=function(t){var n=t.children("div.portlet-body");e("body").hasClass("page-portlet-fullscreen")&&e("body").removeClass("page-portlet-fullscreen"),t.remove()},APP.initPortletPanel=function(t){l(t).find(" div.portlet").each(function(){var t=e(this),n=t.attr("data-url"),r=e("<div class='portlet-title'>");r.append("<div class='caption'><i class='"+(t.attr("panel-icon")?t.attr("panel-icon"):"fa fa-external-link")+"'></i>"+"<span class='caption-subject bold uppercase'>"+(t.attr("panel-title")?t.attr("panel-title"):"")+"</span></div>");var i=t.attr("panel-tools");if(i){var s=e("<div class='tools'>"),o=i.split(",");for(var u=0;u<o.length;u++)s.append("<a class='"+o[u]+"' href='#'></a>");r.append(s)}t.children("div.actions").length>0&&r.append(t.children("div.actions")),t.children("ul.nav-tabs").length>0&&r.append(t.children("ul.nav-tabs")),t.prepend(r);if(!APP.isEmpty(n)){var a=e("<div class='portlet-body'>");if(t.data("scroll-height")){var f=e("<div class='scroller' data-scroll-height="+t.data("scroll-height")+" data-always-visible='1' data-rail-visible='0'>");APP.loadPage(f,n),APP.initScroll(f.get()),a.append(f)}else APP.loadPage(a,n);t.append(a)}h(t)})},APP.initDropdowns=function(t){l(t).find(".dropdown-menu.hold-on-click").on("click",function(t){var n=e(this);if(n.hasClass("dropdown-checkboxes")){var r=e(t.target).prev("[type=checkbox]");r&&r.length==1&&(r.get().checked=!r.get().checked)}t.stopPropagation()})},APP.blockUI=function(t){t=e.extend(!0,{},t);var n="<img src='"+APP.imgPath+"/"+(t.gif?t.gif:"loading")+".gif' /> "+(t.message?t.message:"\u52a0\u8f7d\u4e2d");if(t.target){var r=e(t.target);r.height()<=e(window).height()&&(t.cenrerY=!0),r.block({message:n,baseZ:t.zIndex?t.zIndex:1e3,centerY:t.cenrerY!==undefined?t.cenrerY:!1,css:{top:"10%",border:"0",padding:"0",backgroundColor:"none"},overlayCSS:{backgroundColor:t.overlayColor?t.overlayColor:"#555",opacity:t.boxed?.05:.1,cursor:"wait"}})}else e.blockUI({message:n,baseZ:t.zIndex?t.zIndex:1e3,css:{border:"0",padding:"0",backgroundColor:"none"},overlayCSS:{backgroundColor:t.overlayColor?t.overlayColor:"#555",opacity:t.boxed?.05:.1,cursor:"wait"}})},APP.unblockUI=function(t){t?e(t).unblock({onUnblock:function(){e(t).css("position",""),e(t).css("zoom","")}}):e.unblockUI()},APP.notice=function(t,n,r,i,s,o){APP.isEmpty(i)?require(["jquery/gritter"],function(){e.gritter.add({title:t,text:n,sticky:!1,time:r==="error"?"5000":"3000",class_name:"gritter-"+(r&&r!=undefined?r:"info")}),typeof o=="function"&&o.call(this)}):APP.alertS(t,n,r,i,s)},APP.alertS=function(t,n,r,i,s){var o={ele:i?i:"body",type:r?r:"info",offset:{from:"bottom",amount:0},width:250,delay:1500};o.width=e(o.ele).width();var u,a,f;u=e("<div class='app-noticeS alert'>"),o.type&&u.addClass("alert-"+(o.type=="error"?"danger":o.type)),APP.isEmpty(t)||u.append("<h4 class='alert-heading'>"+t+"</h4>"),u.append("<p>"+n+"</p>"),f=o.offset.amount,e(".app-noticeS").each(function(){return f=Math.max(f,parseInt(e(this).css(o.offset.from))+e(this).outerHeight())});var a={position:o.ele==="body"?"fixed":"absolute","z-index":"9999999",width:o.width+"px","margin-bottom":"0px"};a[o.offset.from]=f+"px",u.css(a),e(o.ele).append(u),u.css("display","none"),u.fadeIn(500),o.delay>0&&u.delay(o.delay).slideUp("fast",function(){e(this).remove();if(s){var t=e(o.ele);t.hasClass("modal")&&t.modal("hide"),t.hasClass("inner")&&APP.returnPage(t)}})},APP.modal=function(t,n,r,i){var s=e.extend(!0,{title:"",show:!0,clear:!1,hasFooter:!0,params:{}},n);s.url?(e(t).length>0&&e(t).remove(),s.show&&e("body").modalmanager("loading"),v(s.url,s.params,function(){m(t,s),s.clear&&e(t).on("hidden.bs.modal",function(){e(this).remove()}),s.show&&e(t).modal("show"),typeof r=="function"&&r.call(this)},i)):(m(t,s),typeof r=="function"&&r.call(this),s.show&&e(t).modal("show"))},APP.showModal=function(e,t,n,r){APP.modal(t,{url:e,params:n},r)},APP.alert=function(e,t,n,r,i){r?APP.alertS(e,t,n,r,i):require(["sweetalert"],function(){swal({title:e,text:APP.isEmpty(t)?"":t,type:APP.isEmpty(n)?"success":n,timer:i?1e3:null,confirmButtonText:"\u786e\u5b9a",cancelButtonText:"\u53d6\u6d88"})})},APP.info=function(e,n,r){typeof e=="object"?APP.alert("",e[t.MSG],"info",n,r):APP.alert("",e,"info",n,r)},APP.success=function(e,n,r){typeof e=="object"?APP.alert("",e[t.MSG],"success",n,r):APP.alert("",e,"success",n,r)},APP.error=function(e,n){typeof e=="object"?APP.alert("",e[t.MSG],"error",n,!1):APP.alert("",e,"error",n,!1)},APP.sysError=function(){APP.alert("\u670d\u52a1\u5f02\u5e38","\u8bf7\u786e\u8ba4\u662f\u5426\u5b58\u5728\u7f51\u7edc\u6216\u670d\u52a1\u5668\u5f02\u5e38!","error")},APP.confirm=function(e,t,n){require(["sweetalert"],function(){swal({title:e,text:APP.isEmpty(t)?"":t,type:"info",showCancelButton:!0,closeOnConfirm:!1,confirmButtonText:"\u786e\u5b9a",cancelButtonText:"\u53d6\u6d88",showLoaderOnConfirm:!0},function(){n.call(this)})})},APP.popover=function(t,n,r,i,s,o,u){if(APP.isEmpty(t.attr("id"))){alert("popover\u663e\u793a\u5bf9\u8c61\u9700\u8981\u6709id\u5c5e\u6027");return}var a=APP.isEmpty(r)?"info":r,f=APP.isEmpty(i)?"fa-info-circle":i,l=APP.isEmpty(s)?"\u63d0\u793a\u6d88\u606f":s,c=APP.isEmpty(o)?"auto left":o;t.popover({html:!0,trigger:"manual",title:"<i class='fa "+f+"'/> "+l,container:e(this).attr("id"),content:n,placement:c}).on("mouseleave",function(){var t=this;setTimeout(function(){e(".popover:hover").length||e(t).popover("hide")},100)}),t.popover("show"),t.siblings(".popover").removeClass("error warning info success").addClass(r),APP.isEmpty(u)||t.siblings(".popover").css({"max-width":"600px",width:u+"px"}),t.siblings(".popover").on("mouseleave",function(){t.popover("hide")})},APP.carousel=function(t,n){require(["jquery/carousel"],function(){var r=e.extend(!0,{autoplay:!0,loop:!0,margin:5},n),i=e(t);i.owlCarousel(r),i.on("mouseover",function(e){i.trigger("stop.owl.autoplay")}),i.on("mouseleave",function(e){i.trigger("play.owl.autoplay")})})},APP.progressBar=function(t,n,r){function u(){var e=g(i);i.appendChild(e.el),s=e.go}l(t).children("div[data-role='progressbar']").remove();var i=document.createElement("div"),s,o={el:i,go:function(e){s(e),e===100&&u()}};return e(i).css({width:"100%",height:"4px",top:0,"z-index":9999}),e(i).attr("data-role","progressbar"),APP.isEmpty(n)||(i.id=n),APP.isEmpty(r)||e(i).addClass(r),t?(i.style.position="relative",e(t).prepend(i)):(i.style.position="fixed",document.getElementsByTagName("body")[0].appendChild(i)),u(),o},APP.initImagebox=function(t){var n=l(t).find(".image-box-button"),r=l(t).find(".video-box-button");if(n.length==0||r.length==0)return;require(["jquery/colorbox"],function(){n.each(function(){var t=e(this).data("rel");e(this).colorbox({maxWidth:"85%",maxHeight:"85%",rel:t,title:e(this).data("title")||""})}),r.colorbox({iframe:!0,innerWidth:640,innerHeight:480})})},APP}),define("app/index",["jquery","app/common"],function(e,t){function p(t){var n=e(".page-sidebar ul");n.children("li.active").removeClass("active"),n.children(".arrow.open").removeClass("open"),t.parents("li").each(function(){e(this).addClass("active"),e(this).children("a > span.arrow").addClass("open")})}function b(){require(["app/form"],function(n){e("form.login-form").initForm({beforeSend:function(t){return API.createLoginHeader(t,e("form.login-form"),e("form.login-form").attr("action"))},beforeSubmit:function(e,n,r){return t.blockUI({target:".login-page",message:"\u767b\u9646\u4e2d",gif:"form-submit"}),!0},success:function(n,r){t.unblockUI(".login-page");if(API.isError(n))t.error(n);else{var i=API.respData(n);API.storeUser(i,API.getServerByUrl(e("form.login-form").attr("action")).KEY),e(".login-page").slideUp("slow",function(){e(this).remove(),t.initIndex(i)})}},error:function(e){t.debug&&console.log(e),t.unblockUI(".login-page"),t.sysError()}})})}function w(){e("body").fadeOut("fast",function(){t.loadPage("body","login",{},function(){e("div.logo img").attr("src",_CONFIG.imgBaseUrl+"/logo.png"),e("body").removeClass().addClass("login").show(),e(".login-page").slideDown("fast",function(){document.forms[0].loginname.focus(),b()})})})}function E(n){var r=e("ul#index-page-sidebar-menu"),i=n[0];r.append("<li class='start active' data-menu-id='"+i.id+"'>"+"<a href="+(t.isEmpty(i.target)||i.target=="#"?"'#'":"'"+i.target+"' class='act-menu'")+" closable>"+"<i class='"+i.icon+"'></i><span class='title'>"+i.name+"</span><span class='selected'></span></a></li>");for(var s=1;s<n.length;s++){var o=n[s];if(t.isEmpty(o.parent_id)||o.parent_id=="-1")r.append("<li data-menu-id='"+o.id+"'>"+"<a href="+(t.isEmpty(o.target)||o.target=="#"?"'#'":"'"+o.target+"' class='act-menu'")+">"+"<i class='"+o.icon+"'></i><span class='title'>"+o.name+"</span><span class='selected'></span></a></li>");else{var u=r.find("li[data-menu-id='"+o.parent_id+"']");u.children("ul.sub-menu").length==0&&(u.children("a").append("<span class='arrow'></span>"),u.append("<ul class='sub-menu'>")),u.children("ul.sub-menu").append("<li data-menu-id='"+o.id+"'>"+"<a href="+(t.isEmpty(o.target)||o.target=="#"?"'#'":"'"+o.target+"' class='act-menu'")+">"+"<i class='"+o.icon+"'></i> "+o.name+"</a></li>")}}}function S(t){require(["app/form"],function(n){e(".sidebar-search input").typeaHead({source:t,displayText:function(e){return"<i class='"+e.icon+"'></i> "+e.name},afterSelect:function(t){e(".sidebar-search input").val(t.name).trigger("change")}}),e(".sidebar-search input").change(function(){var t=e(this).typeahead("getActive");t&&t.name==e(this).val()&&e(".page-sidebar li[data-menu-id='"+t.id+"'] > a.act-menu:first").click()})})}var n=[];if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var r=new Number(RegExp.$1);r==8?t.isIE8=!0:r==9&&(t.isIE9=!0),e("html").addClass("ie")}e("body").css("direction")==="rtl"&&(t.isRTL=!0),t.addResizeHandler=function(e){n.push(e)},t.runResizeHandlers=function(){a()};var i,s=t.getResponsiveBreakpoint("md"),o=function(){return t.getViewPort().height-e(".page-header").outerHeight()},u=function(){var n=e(".page-content"),r=e(".page-sidebar"),i=e("body"),u;if(i.hasClass("page-sidebar-fixed"))u=o();else{var a=e(".page-header").outerHeight();t.getViewPort().width<s?u=t.getViewPort().height-a:u=r.height()+20,u+a<=t.getViewPort().height&&(u=t.getViewPort().height-a)}n.attr("style","min-height:"+u+"px")},a=function(){for(var e=0;e<n.length;e++){var t=n[e];t.call()}},f=function(){var n=e(".page-sidebar-menu");t.destroyScroll(n);if(e(".page-sidebar-fixed").size()===0){u();return}t.getViewPort().width>=s&&(n.attr("data-scroll-height",o()),t.initScroll(n),u())},l=function(){var n;if(t.isIE8){var r;e(window).resize(function(){if(r==document.documentElement.clientHeight)return;n&&clearTimeout(n),n=setTimeout(function(){a()},50),r=document.documentElement.clientHeight})}else e(window).resize(function(){n&&clearTimeout(n),n=setTimeout(function(){a()},50)})},c=function(){var t=e("body");t.hasClass("page-sidebar-fixed")&&e(".page-sidebar").on("mouseenter",function(){t.hasClass("page-sidebar-closed")&&e(this).find(".page-sidebar-menu").removeClass("page-sidebar-menu-closed")}).on("mouseleave",function(){t.hasClass("page-sidebar-closed")&&e(this).find(".page-sidebar-menu").addClass("page-sidebar-menu-closed")})},h=function(n,r,i){n===!0&&e("body").hasClass("page-sidebar-closed")===!1&&(e("body").hasClass("page-sidebar-fixed")?require(["jquery/scrollbar"],function(){r.slimScroll({scrollTo:i.position().top})}):t.scrollTo(i,-200)),u()},d=function(n,r){var i="div.page-content";n&&p(r),t.getViewPort().width<s&&e(".page-sidebar").hasClass("in")&&e(".page-header .responsive-toggler").click();if(r.attr("href")){var o=r.attr("href");v(r)}},v=function(n){var r=e("div.page-tab>ul.nav-tabs"),s=n.attr("href"),o=r.find("a[data-url='"+s+"']"),u=s.replace(/\//g,"-");if(o.length>0){o.tab("show");return}if(r.children("li").length>4)e("#sys-close-tab-act").parents(".gritter-item-wrapper").remove(),t.notice("\u7cfb\u7edf\u8b66\u544a","\u6253\u5f00\u9875\u9762\u4e0d\u80fd\u8d85\u8fc75\u4e2a,\u662f\u5426<a href='#' id='sys-close-tab-act'>\u5173\u95ed\u4e0a\u4e2a</a>\u9875\u9762?","warning","","",function(){e("#sys-close-tab-act").click(function(){e("div.page-tab>ul.nav-tabs>li:eq(1)").remove(),e("div.page-tab>.tab-content>.tab-pane:eq(1)").remove(),v(n),e("#sys-close-tab-act").parents(".gritter-item-wrapper").remove()})});else{i=s;var a=e("<li role='presentation'> <a href='#"+u+"' data-toggle='tab' data-url='"+s+"'>"+"<i class='"+n.children("i").attr("class")+"'></i>"+n.text()+"&nbsp;</a></li>");n.attr("closable")===undefined&&a.append("<i class='fa fa-times close-tab' style='display: none'></i>"),r.append(a),a.children("i.close-tab").click(function(){a.hasClass("active")&&a.prev().children("[data-toggle='tab']").tab("show"),a.remove(),e("#"+u).remove()}),e("div.page-tab>div.tab-content").append("<div class='tab-pane main-page-content' id='"+u+"' data-url='"+s+"'></div>"),r.on("mouseover","li[role='presentation']",function(){e(this).find(".close-tab").show()}),r.on("mouseleave","li[role='presentation']",function(){e(this).find(".close-tab").hide()}),e("a[href='#"+u+"']").on("shown.bs.tab",function(){i=e(this).data("url")}),t.loadPage("#"+u,s,{},function(){e("a[href='#"+u+"']").tab("show")},function(){t.notice("\u7cfb\u7edf\u9519\u8bef","\u9875\u9762\u52a0\u8f7d\u9519\u8bef","error"),a.remove(),e("#"+u).remove()}),e("a[href='#"+u+"']").on("shown.bs.tab",function(){p(n)})}},m=function(){e(".page-sidebar").on("click","li > a",function(n){var r=e(this).next().hasClass("sub-menu");if(t.getViewPort().width>=s&&e(this).parents(".page-sidebar-menu-hover-submenu").size()===1)return;if(r===!1){t.getViewPort().width<s&&e(".page-sidebar").hasClass("in")&&e(".page-header .responsive-toggler").click();return}if(e(this).next().hasClass("sub-menu always-open"))return;var i=e(this).parent().parent(),o=e(this),u=e(".page-sidebar-menu"),a=e(this).next(),f=u.data("auto-scroll"),l=parseInt(u.data("slide-speed")),c=u.data("keep-expanded");c!==!0&&(i.children("li.open").children("a").children(".arrow").removeClass("open"),i.children("li.open").children(".sub-menu:not(.always-open)").slideUp(l),i.children("li.open").removeClass("open")),a.is(":visible")?(e(".arrow",e(this)).removeClass("open"),e(this).parent().removeClass("open"),a.slideUp(l,function(){h(f,u,o)})):r&&(e(".arrow",e(this)).addClass("open"),e(this).parent().addClass("open"),a.slideDown(l,function(){h(f,u,o)})),n.preventDefault()}),e(".page-sidebar").on("click"," li > a.act-menu",function(t){t.preventDefault(),d(!0,e(this))}),e(".page-content").on("click",".act-menu",function(t){t.preventDefault(),d(!1,e(this))}),c()},g=function(){var n=e("body");e.cookie&&e.cookie("sidebar_closed")==="1"&&t.getViewPort().width>=s&&(e("body").addClass("page-sidebar-closed"),e(".page-sidebar-menu").addClass("page-sidebar-menu-closed")),e("body").on("click",".sidebar-toggler",function(t){var r=e(".page-sidebar"),i=e(".page-sidebar-menu");e(".sidebar-search",r).removeClass("open"),n.hasClass("page-sidebar-closed")?(n.removeClass("page-sidebar-closed"),i.removeClass("page-sidebar-menu-closed"),e.cookie&&e.cookie("sidebar_closed","0")):(n.addClass("page-sidebar-closed"),i.addClass("page-sidebar-menu-closed"),n.hasClass("page-sidebar-fixed")&&i.trigger("mouseleave"),e.cookie&&e.cookie("sidebar_closed","1")),e(window).trigger("resize")}),c(),e(".page-sidebar").on("click",".sidebar-search .remove",function(t){t.preventDefault(),e(".sidebar-search").removeClass("open")}),e(".page-sidebar .sidebar-search").on("keypress","input.form-control",function(e){if(e.which==13)return!1}),e(".sidebar-search").size()!==0&&(e(".sidebar-search .input-group").on("click",function(e){e.stopPropagation()}),e("body").on("click",function(){e(".sidebar-search").hasClass("open")&&e(".sidebar-search").removeClass("open")}))},y=function(){e(".page-header").on("click",'.hor-menu a[data-toggle="tab"]',function(t){t.preventDefault();var n=e(".hor-menu .nav"),r=n.find("li.current");e("li.active",r).removeClass("active"),e(".selected",r).remove();var i=e(this).parents("li").last();i.addClass("current"),i.find("a:first").append('<span class="selected"></span>')}),e(".page-header").on("click",".search-form",function(t){e(this).addClass("open"),e(this).find(".form-control").focus(),e(".page-header .search-form .form-control").on("blur",function(t){e(this).closest(".search-form").removeClass("open"),e(this).unbind("blur")})}),e(".page-header").on("keypress",".hor-menu .search-form .form-control",function(t){if(t.which==13)return e(this).closest(".search-form").submit(),!1}),e(".page-header").on("mousedown",".search-form.open .submit",function(t){t.preventDefault(),t.stopPropagation(),e(this).closest(".search-form").submit()}),e('[data-hover="megamenu-dropdown"]').not(".hover-initialized").each(function(){e(this).dropdownHover(),e(this).addClass("hover-initialized")}),e(document).on("click",".mega-menu-dropdown .dropdown-menu",function(e){e.stopPropagation()}),t.isMobile&&e("body").addClass("page-header-fixed-mobile")};return t.showIndex=function(){API.getLoginUser(function(e){t.initIndex(e)},function(e){API.isUnAuthorized(e)&&w()})},t.initIndex=function(n){e("body").removeClass().addClass("page-header-fixed page-sidebar-fixed").css("display","none"),t.loadPage("body","main",{},function(){e("img.logo-default").attr("src",_CONFIG.imgBaseUrl+"/logo.png");var r=API.jsonData(API.urls.menuUrl+n.id);E(r),f(),l(),m(),g(),y(),S(r),t.initScroll(".scroller"),t.addResizeHandler(f),t.addResizeHandler(u),e(".dropdown-user .username").html(n.name),e(".dropdown-user img").attr("src",t.isEmpty(n.photo)?_CONFIG.imgBaseUrl+"/user-admin-sm.jpg":n.photo),require(["domReady!"],function(t){e("body").fadeIn("slow")}),e("[data-toggle='refresh-page']").on("click",function(){var n=e(".page-tab>.tab-content>.tab-pane.active");n.children().remove(),t.loadPage("#"+n.attr("id"),n.data("url"),{},function(){},function(){t.notice("\u7cfb\u7edf\u9519\u8bef","\u9875\u9762\u52a0\u8f7d\u9519\u8bef","error")})}),e("[data-toggle='close-all']").on("click",function(){e("div.page-tab>ul.nav-tabs>li:gt(0)").remove(),e("div.page-tab>.tab-content>.tab-pane:gt(0)").remove(),e("div.page-tab>ul.nav-tabs>li:eq(0)>a").tab("show")}),e("[data-toggle='logout']").on("click",function(){API.logout(),w()});if(t.debug){var s=e("<li><a href='#'> \u67e5\u770b\u94fe\u63a5 </a></li>");s.click(function(){t.info(i)});var o=e("<li><a href='#'> \u6e05\u7a7a\u7f13\u5b58 </a></li>");o.click(function(){API.clearLocalData(),setTimeout(function(){window.location.reload()},500)}),e(".page-content .btn-group.pull-right>.dropdown-menu").append(s),e(".page-content .btn-group.pull-right>.dropdown-menu").append(o)}e(".page-sidebar li > a.act-menu:first").click()},function(e){t.error(e)})},t}),define("app/form",["jquery","app/common","app/api","moment","jquery/validate","jquery/form","switch","bootstrap/typeahead","bootstrap/datepicker"],function(e,t,n){function o(e,n,r,i){var s=r.attr("name"),o=r.attr("form-role");if(r.attr("type")=="checkbox"){var u=!t.isEmpty(r.attr("checked"));i&&(u=r.val()==(r.data("on-value")!==undefined?r.data("on-value")+"":"1"),r.prop("checked",u)),r.hasClass("bs-switch")&&(r.bootstrapSwitch("state",u),r.trigger("switch:change",[u]))}e.rules&&e.rules[s]&&(r.rules("remove"),e.rules[s].checkExists&&(e.rules[s].checkExists.original=r.val()),r.rules("add",e.rules[s]));if(n.data("form-init")){o=="file"&&e.initClear&&r.fileUpload(e.fieldOpts[s]),o=="richEdit"&&require(["jquery/summernote"],function(){r.summernote("code",i?r.data("original"):"")}),o=="date"&&r.datepicker("update",t.formatDate(r.data("format"),i?r.data("original"):t.formatDate("YYYY-MM-DD")));return}if(o=="select"){var a=e.fieldOpts[s]||{};r.select(a)}else if(o=="treeSelect"){var f=e.fieldOpts[s]||{};r.data("stmid")&&(f.stmID=r.data("stmid"));if(t.isEmpty(r.attr("id"))){alert("\u8bf7\u6307\u5b9atreeSelect\u8868\u5355\u5143\u7d20\u7684id\u5c5e\u6027");return}r.treeSelect(f)}else if(o=="date"){var l=e.fieldOpts[s]||{};r.data("view-type")&&(l.viewType=r.data("view-type")),r.data("format")&&(l.format=r.data("format")),l.defaultDate=r.data("original"),r.datePicker(l)}else if(o=="dateRange"){var c=e.fieldOpts[s]||{};r.data("start-date")&&(c.startDate=r.data("start-date")),r.data("end-date")&&(c.endDate=r.data("end-date")),r.data("min-date")&&(c.minDate=r.data("min-date")),r.data("max-date")&&(c.maxDate=r.data("max-date")),r.data("format")&&(c.format=r.data("format")),r.data("start-name")&&(c.startName=r.data("start-name")),r.data("end-name")&&(c.endName=r.data("end-name")),r.wrap("<div class='input-group'></div>"),r.after("<span class='input-group-btn'><button class='btn default' type='button'><i class='fa fa-calendar'></i></button></span>"),r.parent().dateRangePicker(c)}else if(o=="richEdit"){var h=e.fieldOpts[s]||{};r.summerNote(h),require(["jquery/summernote"],function(){e.initClear&&r.summernote("reset"),i&&r.summernote("code",r.data("original"))})}else if(o=="file"){var p=e.fieldOpts[s]||{};r.fileUpload(p)}}function u(e,t){var n=t.attr("name"),r=t.attr("form-role"),i=e.formData[n];if(n.indexOf(".")>0){var s=n.split(".");i=e.formData[s[0]];for(var o=1;i&&o<s.length;o++)i=i[s[o]]}i!=undefined?(t.val(i).trigger("change"),t.data("original",i)):t.data("init")&&t.val(t.data("init")).trigger("change")}function a(t,n,r){var i=r.attr("name"),s=r.attr("form-role");!(t.isView||t.fieldOpts[i]&&t.fieldOpts[i].isView)||n.type=="hidden"&&s!="file"?r.hasClass("bs-switch")?r.closest(".bootstrap-switch-wrapper").show():s=="select"?r.siblings(".select2.select2-container").show():s=="treeSelect"?r.closest("div.tree-select").show():s=="file"?r.siblings("div.file-upload-zone").find(".fileinput-button,.drop-file").show():s=="richEdit"?r.siblings("div.note-editor").show():r.show():n.type=="password"?r.hide().before("<p class='form-control-static'>****</p>"):r.hasClass("bs-switch")?(r.closest(".bootstrap-switch-wrapper").hide().before("<p class='form-control-static'>"+(r.bootstrapSwitch("state")?r.bootstrapSwitch("onText"):r.bootstrapSwitch("offText"))+"</p>"),r.on("switch:change",function(e,t){r.closest(".bootstrap-switch-wrapper").siblings("p.form-control-static").html(t?r.bootstrapSwitch("onText"):r.bootstrapSwitch("offText"))})):s=="select"?(r.siblings(".select2.select2-container").hide().before("<p class='form-control-static'>"+r.find("option:selected").text()+"</p>"),r.change(function(){r.siblings("p.form-control-static").html(r.find("option:selected").text())})):s=="treeSelect"?(r.closest("div.tree-select").hide(),r.change(function(){r.closest("div.tree-select").before("<p class='form-control-static'>"+r.val()+"</p>")})):s=="file"?r.siblings("div.file-upload-zone").find(".fileinput-button,.drop-file").hide():s=="richEdit"?(r.siblings("div.note-editor").hide().before("<p class='form-control-static'></p>"),r.siblings(".form-control-static").html(r.val())):(r.parent(".input-group").length==1?r.parent(".input-group").hide().before("<p class='form-control-static'>"+r.val()+"</p>"):r.hide().before("<p class='form-control-static'>"+r.val()+"</p>"),r.change(function(){r.siblings(".form-control-static").html(e(this).val())}))}function f(r,i,s,o,u){t.isEmpty(i.url)?i.submitClear=!0:t.notice("",n.respMsg(r),"success",o,i.autoClose),i.submitClear&&(s.clearForm(!0),s.find("input[form-role='file']:hidden").each(function(){e(this).fileUpload(i.fieldOpts[e(this).attr("name")]||{})}),s.find("[form-role='richEdit']").each(function(){e(this).summernote("reset")}),require(["app/datatables"],function(t){s.find("table.datatable[data-form]").each(function(){e(this).dataTable().api().clear().draw()})})),s.find(".checkExists").each(function(){var t=e(this),n=t.attr("name");i.rules&&i.rules[n]&&i.rules[n].checkExists&&(t.rules("remove","checkExists"),i.rules[n].checkExists.original=t.val(),t.rules("add",i.rules[n]))}),typeof u=="function"?t.isEmpty(i.url)?(u.call(this,r),o!="body"&&e(o).modal("hide")):u.call(this,n.respData(r)):typeof i.onSuccess=="function"&&i.onSuccess.call(this,n.respData(r))}function l(e){var t={};for(var n=0;n<e.length;n++)t[e[n].name]=e[n].value;return t}function c(e,r,i,s,o,u,a,c){r.valid()&&n.ajax(i,l(s),!0,function(i){t.unblockUI(o),c?typeof u=="function"&&u.call(this,n.respData(i)):f(i,e,r,o,u)},function(r,i){t.unblockUI(o),t.notice("",n.respMsg(r),"warning",o),typeof a=="function"?a(r):e.onError&&e.onError(r)})}function h(e,r,i,s,o,u){t.blockUI({target:s,message:e.onSubmitMsg||"\u63d0\u4ea4\u4e2d",gif:"form-submit"}),r.valid()&&n.ajax(i,{},!0,function(r){t.unblockUI(s),e.queryForm?typeof o=="function"&&o.call(this,n.respData(r)):n.isError(r)?(t.notice("",n.respMsg(r),"warning",s),typeof u=="function"?u.call(this,r):e.onError&&e.onError(r)):(t.notice("",n.respMsg(r),"success",s,e.autoClose),typeof o=="function"?o.call(this,n.respData(response)):typeof e.onSuccess=="function"&&e.onSuccess.call(this,n.respData(response)))},function(r,i){t.unblockUI(s),t.notice("",n.respMsg(r),"warning",s),typeof u=="function"?u(r):e.onError&&e.onError(r)})}function v(e){e.val()!="-1"&&e.val()!=""&&(e.closest(".form-group").removeClass("has-error"),e.siblings("span#"+e.attr("id")+"-error").remove(),e.siblings("i.validate-icon").removeClass("fa-check fa-warning").removeAttr("data-original-title"))}function m(t,n){t.empty();if(e.isArray(n))for(var r=0;r<n.length;r++)t.append("<option value='"+n[r].id+"'>"+n[r].text+"</option>");t.change(),v(t)}function g(e){var t=e.dataUrl||n.urls.stmListUrl,r={};e.stmID&&(t+="/"+e.stmID+_CONFIG.HTTP.SUFFIX),e.param&&(r.param=e.param),e.paramData&&(r=e.paramData);var i=n.jsonData(t,r);return y(e,i),i}function y(n,r){if(n.idProperty||n.textProperty)if(e.isArray(r))for(var i=0;i<r.length;i++)n.idProperty&&(r[i].id=r[i][n.idProperty]),n.textProperty&&(r[i].text=r[i][n.textProperty]);else t.isEmpty(r)||(n.idProperty&&(r.id=r[n.idProperty]),n.textProperty&&(r.text=r[n.textProperty]))}function b(r,i,s,o,u){if(n.isError(r)){if(n.isUnAuthorized(r)){i.useLoginForm?n.showLogin():n.backLogin(i);return}t.notice("",n.respMsg(r),"warning"),typeof u=="function"&&u.call(this,r)}else{var a=n.respData(r);if(e.isArray(a))for(var f=0;f<a.length;f++){if(f>o.maxFiles)break;w(i,a[f],s,o)}else o.savePath&&s.children("input[form-role='file']:hidden").val(i.fileSrvUrl+a.url),w(i,a,s,o);s.find("div.file").length>=o.maxFiles?s.find(".fileinput-button").hide():s.find(".fileinput-button").show()}}function w(r,i,s,o){var u=e("<div class='col-md-"+o.col+" file'><span class='badge badge-danger drop-file'> &times; </span></div>");s.children(".file-upload-zone").prepend(u),u.children("span.drop-file").click(function(){n.ajax(r.getFileDropUrl(i),i,!0,function(e){u.remove(),s.find("div.file").length<o.maxFiles&&s.find(".fileinput-button").show()})});var a=i.name.length>o.col*5?i.name.substr(0,o.col*5-2)+"...":i.name;/\.(GIF|JPG|JPEG|PNG)$/.test(i.name.toUpperCase())?(u.prepend("<a href='"+r.fileSrvUrl+i.url+"' data-rel='"+i.type+"' class='thumbnail image-box-button' data-title='"+i.name+"'>"+"<img src='"+r.fileSrvUrl+i.url+"' alt='"+i.name+"'><span class='file-name' title='"+i.name+"'>"+a+"</span></a>"),t.initImagebox(u)):u.prepend("<a href='"+r.fileSrvUrl+i.url+"' target='_blank' class='thumbnail'>"+"<i class='fa fa-file'></i> <span class='file-name' title='"+i.name+"'>"+a+"</span></a>")}function E(t,n,r,i){var s=e(t),o=s.find("form");o.initForm(n,function(e){typeof r=="function"?r.call(this,e,function(){s.modal("hide")}):s.modal("hide")},function(e){typeof i=="function"&&i.call(this,e)})}var r=require("moment");r.locale("zh-cn");var i={initDatePicker:function(n){t.queryContainer(n).find('[form-role="date"]').each(function(){e(this).datePicker()})}};i.formToJson=function(t){var n={},r=t.serializeArray();return e(r).each(function(){n[this.name]?e.isArray(n[this.name])?n[this.name].push(this.value):n[this.name]=[n[this.name],this.value]:n[this.name]=this.value}),n},e.fn.datePicker=function(n,r){var i=e(this),s=e.extend(!0,{language:"zh-CN",autoclose:!0,todayHighlight:!0,format:"yyyy-mm-dd",zIndexOffset:9999,orientation:"auto"},n),o="changeDate";s.viewType=="year"?(s.startView=2,s.minViewMode=2,o="changeYear"):s.viewType=="month"&&(s.startView=1,s.minViewMode=1,o="changeMonth"),i.datepicker(s),i.datepicker("update",t.formatDate(s.format.toUpperCase(),s.defaultDate)),i.data("date-value",t.formatDate("YYYY-MM-DD",s.defaultDate)),i.datepicker().on(o,function(e){i.data("date-value")!=t.formatDate("YYYY-MM-DD",e.date)&&(i.data("date-value",t.formatDate("YYYY-MM-DD",e.date)),typeof r=="function"?r(t.formatDate("YYYY-MM-DD",e.date)):typeof n.onChange=="function"&&n.onChange(t.formatDate("YYYY-MM-DD",e.date)))})},e.fn.dateRangePicker=function(n,i){var s=e(this);require(["bootstrap/daterangepicker"],function(){var o=e.extend(!0,{opens:t.isRTL?"left":"right",startDate:r().subtract("days",29).format("YYYY-MM-DD"),endDate:r().format("YYYY-MM-DD"),minDate:"2012-01-01",maxDate:r().format("YYYY-MM-DD"),dateLimit:{days:365},showDropdowns:!0,showWeekNumbers:!0,timePicker:!1,timePickerIncrement:1,timePicker12Hour:!0,buttonClasses:["btn"],applyClass:"green",cancelClass:"default",format:"YYYY-MM-DD",separator:" \u5230 ",locale:{applyLabel:"\u786e\u5b9a",cancelLabel:"\u53d6\u6d88",fromLabel:"\u4ece",toLabel:"\u5230",customRangeLabel:"\u65e5\u671f\u533a\u95f4\u9009\u62e9",daysOfWeek:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],monthNames:["1\u6708","2\u6708","3\u6708","4\u6708","5\u6708","6\u6708","7\u6708","8\u6708","9\u6708","10\u6708","11\u6708","12\u6708"],firstDay:1},startName:"startDate",endName:"endDate"},n),u=e("<input type='hidden' name='"+o.startName+"'>"),a=e("<input type='hidden' name='"+o.endName+"'>");s.append(u).append(a),s.daterangepicker(o,function(e,t,n){if(typeof i=="function")i(e,t,n);else{var r=e.format("YYYY\u5e74MM\u6708DD\u65e5")+" - "+t.format("YYYY\u5e74MM\u6708DD\u65e5");s.hasClass("input-group")?s.children("input:text").val(r):s.children("span").html(r),u.val(e.format(o.format)),a.val(t.format(o.format))}});var f=r(o.startDate).format("YYYY\u5e74MM\u6708DD\u65e5")+" - "+r(o.endDate).format("YYYY\u5e74MM\u6708DD\u65e5");s.hasClass("input-group")?s.children("input:text").val(f):s.children("span").html(f),u.val(o.startDate),a.val(o.endDate)})};var s={errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!0,onkeyup:!1,errorPlacement:function(e,t){if(t.parent(".input-group").size()>0)e.insertAfter(t.parent(".input-group"));else if(t.attr("data-error-container"))e.appendTo(t.attr("data-error-container"));else if(t.parents(".radio-list").size()>0)e.appendTo(t.parents(".radio-list").attr("data-error-container"));else if(t.parents(".radio-inline").size()>0)e.appendTo(t.parents(".radio-inline").attr("data-error-container"));else if(t.parents(".checkbox-list").size()>0)e.appendTo(t.parents(".checkbox-list").attr("data-error-container"));else if(t.parents(".checkbox-inline").size()>0)e.appendTo(t.parents(".checkbox-inline").attr("data-error-container"));else if(t.siblings("i.validate-icon").size()>0){var n=t.siblings("i.validate-icon");n.removeClass("fa-check").addClass("fa-warning"),n.attr("data-original-title",e.text()).tooltip({placement:"auto left"})}else e.insertAfter(t)},invalidHandler:function(e,t){},highlight:function(t){e(t).closest(".form-group").removeClass("has-success").addClass("has-error")},success:function(t,n){if(e(n).siblings("i.validate-icon").size()>0){var r=e(n).siblings("i.validate-icon");e(n).closest(".form-group").removeClass("has-error").addClass("has-success"),r.removeClass("fa-warning"),e(n).tagName=="INPUT"&&r.addClass("fa-check"),r.removeAttr("data-original-title")}else t.closest(".form-group").removeClass("has-error")}};e.validator.addMethod("decimal",function(n,r){if(t.isEmpty(n))return!0;if(!e.isNumeric(n))return!1;var i=e(r).data("digit")||2,s=n.split(".");return s.length===2?s[1].length<=i:!0},"\u5c0f\u6570\u683c\u5f0f\u4e0d\u6b63\u786e"),e.validator.addMethod("selectOpt",function(e,t){return this.optional(t)||e!="-1"},"\u8bf7\u9009\u62e9"),e.validator.addMethod("checkExists",function(r,i,s){if(t.isEmpty(r))return!0;if(t.isEmpty(s))return alert("\u8bf7\u8bbe\u7f6e\u5b57\u6bb5\u6821\u9a8c\u53c2\u6570"),!1;if(t.isEmpty(s.url)&&t.isEmpty(s.stmID||s.stmid||s.stmId))return alert("\u8bf7\u8bbe\u7f6e\u5b57\u6bb5\u6821\u9a8c\u53c2\u6570\u4e2d\u7684url\u6216\u8005stmID"),!1;var o={param:s.data||{}};o.param[i.name]=r,s.original&&(o.param["o_"+i.name]=s.original);if(s.joinField)if(e.isArray(s.joinField))for(var u=0;u<s.joinField.length;u++){var a=e(s.joinField[u]);o.param[a.attr("name")]=a.val(),a.data("original")&&a.data("original")!=a.val()&&(o.param["o_"+i.name]="")}else{var a=e(s.joinField);console.log(a),console.log(a.val()),o.param[a.attr("name")]=a.val(),a.data("original")&&a.data("original")!=a.val()&&(o.param["o_"+i.name]="")}if(!t.isEmpty(s.url))return n.jsonData(s.url,o);var f=s.stmID||s.stmid||s.stmId;return t.isEmpty(n.getListByStmId(f,o))},"\u5df2\u5b58\u5728"),e.fn.initForm=function(r,i,p){var d=e(this),v=e.extend(!0,{isView:!1,fieldSelector:"*[name]",ajax:!0,submitClear:!0,initClear:!0,dataType:"json",type:"post",includeHidden:!0,validate:s,fieldOpts:{},autoClose:!1,rules:null,formData:null,url:d.attr("action"),submitJson:!1,initComplete:null,beforeInit:null},r);typeof v.beforeInit=="function"&&v.beforeInit.call(this,v),v.initClear&&d.clearForm(!0),d.find("p.form-control-static").remove(),d.validate(v.validate);var m=!t.isEmpty(v.formData);d.find(v.fieldSelector).each(function(){var t=e(this);m?u(v,t):t.removeData("original"),o(v,d,t,m),a(v,this,t)});var g=d.parents(".modal").size()>0?d.parents(".modal").get(0):t.getPageContainer(d),y=v.url,b,w;t.isEmpty(y)||(b=n.getServerByUrl(y),w=b.getUrl(y),v.url=b.srvUrl+w),e("input[type=file]:enabled",d).length>0&&(v.formData=null);var E=e.extend(!0,{beforeSend:function(e){if(!v.headers)return n.createHeader(b,w,e,p)},beforeSubmit:function(n,r,s){return t.isEmpty(v.url)?(f(l(n),v,d,g,i),!1):b.isLocalData?(h(v,d,y,g,i,p),!1):v.queryForm?(t.blockUI({target:g,message:v.onSubmitMsg||"\u67e5\u8be2\u4e2d",gif:"form-submit"}),c(v,d,y,n,g,i,p,!0),!1):(t.blockUI({target:g,message:v.onSubmitMsg||"\u63d0\u4ea4\u4e2d",gif:"form-submit"}),v.submitJson?(r.find("table.datatable[data-form]").length>0?require(["app/datatables"],function(t){r.find("table.datatable[data-form]").each(function(){n.push({name:e(this).data("form"),value:e(this).dataTable().api().tableData()})}),c(v,d,y,n,g,i,p,!1)}):c(v,d,y,n,g,i,p,!1),!1):!0)},error:function(e){console.error(e),t.unblockUI(g),t.notice("","\u7cfb\u7edf\u9519\u8bef["+e.status+"] "+e.statusText,"error",g),typeof p=="function"?p(e):v.onError&&v.onError(e)},success:function(e,r){var s=b.resp(e);t.debug&&console.log(s),t.unblockUI(g);if(n.isError(s)){if(n.isUnAuthorized(s)){b.useLoginForm?n.showLogin():n.backLogin(b,null,d.get());return}t.notice("",n.respMsg(s),"warning",g),typeof p=="function"?p.call(this,s,r):typeof v.onError=="function"&&v.onError.call(this,s,r)}else f(s,v,d,g,i)}},v);d.data("form-init",!0),E.ajax&&d.ajaxForm(E),typeof v.initComplete=="function"&&v.initComplete.call(this,v)};var p={errorLoading:function(){return"\u65e0\u6cd5\u8f7d\u5165\u7ed3\u679c\u3002"},inputTooLong:function(e){var t=e.input.length-e.maximum,n="\u8bf7\u5220\u9664"+t+"\u4e2a\u5b57\u7b26";return n},inputTooShort:function(e){var t=e.minimum-e.input.length,n="\u8bf7\u518d\u8f93\u5165\u81f3\u5c11"+t+"\u4e2a\u5b57\u7b26";return n},loadingMore:function(){return"\u8f7d\u5165\u66f4\u591a\u7ed3\u679c\u2026"},maximumSelected:function(e){var t="\u6700\u591a\u53ea\u80fd\u9009\u62e9"+e.maximum+"\u4e2a\u9879\u76ee";return t},noResults:function(){return"\u672a\u627e\u5230\u7ed3\u679c"},searching:function(){return"\u641c\u7d22\u4e2d\u2026"}},d={language:p,placeholder:{id:"-1",text:"\u8bf7\u9009\u62e9..."},maximumSelectionLength:50,allowClear:!0,width:"100%"};return e.fn.select=function(r){var i=e(this),s={};try{i.attr("placeholder")&&(s.placeholder=JSON.parse(i.attr("placeholder")))}catch(o){alert("placeholder\u5c5e\u6027\u503c\u5fc5\u987b\u4e3ajson\u5b57\u7b26\u4e32")}if(t.isEmpty(r.data)){if(i.data("json"))s.jsonData=i.data("json");else if(i.data("stmid"))s.stmID=i.data("stmid");else if(i.data("dict-type")){s.data=n.getDictByType(i.data("dict-type"));if(e.isArray(s.data))for(var u=0;u<s.data.length;u++)s.data[u].id=s.data[u].value,s.data[u].text=s.data[u].name}}else y(r,r.data);var a=e.extend(!0,s,r);if((a.jsonData||a.stmID||a.dataUrl)&&a.data===undefined){t.isEmpty(a.param)&&(a.param={});if(i.data("parent-for")){var f=e(i.data("parent-for"));a.param[f.attr("name").replace(".","_")]=f.val()}a.jsonData&&a.jsonData!=""?a.data=n.localData(a.jsonData):a.data=g(a)}else a.url&&a.ajax===undefined&&(a.ajax={delay:250,url:a.url,data:function(e){var t={q:e.term};return t}});if(a.allowAdd||i.data("allow-add")){i.parent(".input-group").length>0&&(i.nextAll(".input-group-btn").remove(),i.unwrap());var l="select-add-btn-"+(new Date).getTime(),c=e("<span class='input-group-btn' id='"+l+"'><a class='btn blue'><i class='fa fa-plus'></i></a></span>");i.wrap("<div class='input-group'></div>"),c.insertAfter(i),c.click(function(){var n=e(this),r=e("<div>"),s=e("<div class='row'><div class='col-md-12'><div class='form-group'><label class='control-label col-md-3'>\u4ee3\u7801</label><div class='col-md-9'><input type='text' name='_select_type_code' class='form-control input-small'></div></div></div></div><div class='row'><div class='col-md-12'><div class='form-group'><label class='control-label col-md-3'>\u540d\u79f0</label><div class='col-md-9'><input type='text' name='_select_type_name' class='form-control input-small'></div></div></div></div><a class='btn blue btn-block'> <i class='fa fa-plus'></i> \u589e\u52a0 </a>");r.append(s),r.children(".btn").click(function(){var t=r.find("input[name='_select_type_code']").val(),s=r.find("input[name='_select_type_name']").val();if(e.trim(t)==""||e.trim(s)==""){r.closest(".popover").removeClass("info").addClass("error"),r.closest(".popover-content").prev().html("<i class='fa fa-plus'/> \u4ee3\u7801\u6216\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a");return}if(i.children("option[value='"+t+"']").length>0){r.closest(".popover").removeClass("info").addClass("error"),r.closest(".popover-content").prev().html("<i class='fa fa-plus'/> \u4ee3\u7801\u5df2\u5b58\u5728");return}r.closest(".popover").removeClass("error"),i.append("<option value='"+t+"'>"+s+"</option>"),i.val(t).trigger("change"),n.popover("destroy")}),t.popover(n,r.get(),"info","fa-plus","\u589e\u52a0\u9009\u62e9","auto right",235)})}var h=e.extend(!0,{},d,a);return require(["jquery/select2"],function(){i.select2(h)}),i.data("options",h.data),i.data("original")||i.data("init")?i.val(i.data("original")||i.data("init")).trigger("change"):i.val(i.val()).trigger("change"),t.isEmpty(i.data("event-init"))&&i.on("select2:select",function(e){v(i)}),i.data("parent-for")&&t.isEmpty(i.data("event-init"))&&e(i.data("parent-for")).on("change",function(){a.param[e(this).attr("name").replace(".","_")]=e(this).val(),m(i,g(a))}),i.data("event-init","init"),i},i.getSelectedVal=function(t){return e(t).val()},i.getSelectedText=function(t){return e(t).find("option:selected").text()},e.fn.treeSelect=function(n){var r=e(this),i=r.attr("id"),s=r.parent(),o=r.attr("name"),u=r.prevAll("input[data-id-for='"+o+"']");if(u.length==0)return alert("\u8bf7\u5728treeSelect\u5143\u7d20\u4e4b\u524d\u6dfb\u52a0id\u503c\u63a7\u4ef6"),r;var a=r.prevAll("input[data-tree-for='"+o+"']"),f="id",l="name",c="pId",h="sort";t.isEmpty(r.attr("tree-key-id"))||(f=r.attr("tree-key-id")),t.isEmpty(r.attr("tree-key-name"))||(l=r.attr("tree-key-name")),t.isEmpty(r.attr("tree-key-pid"))||(c=r.attr("tree-key-pid")),t.isEmpty(r.attr("tree-key-sort"))||(h=r.attr("tree-key-sort")),n&&n.data&&(n.data.key&&n.data.key.name&&(l=n.data.key.name),n.data.simpleData&&(n.data.simpleData.idKey&&(f=n.data.simpleData.idKey),n.data.simpleData.pIdKey&&(c=n.data.simpleData.pIdKey)));var p=e("<div class='input-group tree-select'></div>"),d=e("<div class='input-icon'>"),v=e("<i class='fa fa-times fa-fw'></i>");d.append(v);var m=e("<span class='input-group-btn' style='cursor: pointer;'><button class='btn btn-success' type='button'><i class='fa fa-list'></i></span>");d.append(r),r.css("cursor","pointer"),p.append(d),p.append(m),s.append(p);var g=e("<div id='"+i+"_MenuContent' style='display:none;height: 150px;overflow-y: auto; background-color: #F5F5F5;'></div>"),y=e("<ul id='"+i+"' class='ztree treeSelect' style='margin-top:0; width:100%;'></ul>");return g.append(y),s.append(g),require(["app/tree"],function(){function o(t){e("#"+t).fadeOut("fast"),e("body").unbind("mousedown",p)}function p(t){t.target.id==t.data.menuContentID||e(t.target).parents("#"+t.data.menuContentID).length>0||o(t.data.menuContentID)}function d(){if(g.css("display")=="none"){var t=r.offset();g.css({width:+t.width+"px",left:t.left+"px",top:t.top+r.outerHeight()+"px"}).slideDown("fast"),e("body").bind("mousedown",{menuContentID:i+"_MenuContent"},p)}}var s=e.extend(!0,{data:{key:{name:l},simpleData:{enable:!0,idKey:f,pIdKey:c}},callback:{onClick:function(i,s,o){var c=e.fn.zTree.getZTreeObj(s),p=c.getSelectedNodes(),d="",m="";p.sort(function(t,n){return t[f]-n[f]});for(var g=0,y=p.length;g<y;g++)d+=p[g][l]+",",m+=p[g][f]+",";if(a.length==1){var b="";t.isEmpty(o[h])?b="0-"+o[f]:b=o[h]+"-"+o[f],t.isEmpty(o.parentTree)?t.isEmpty(o.parent_tree)||(b=o.parent_tree+","+b):b=o.parentTree+","+b,a.val(b)}d.length>0&&(d=d.substring(0,d.length-1)),m.length>0&&(m=m.substring(0,m.length-1)),r.val(d).trigger("change"),r.closest(".form-group").removeClass("has-error"),r.parent().siblings("span#"+r.attr("id")+"-error").remove(),r.parent().siblings("i.validate-icon").removeClass("fa-check fa-warning").removeAttr("data-original-title"),u.val(m),v.css("color","red"),n.onClick&&n.onClick.toFunc().call(this,i,s,o)},onAsyncSuccess:function(t,i,s,o){if(s===undefined){var a=e.fn.zTree.getZTreeObj(i);if(u.attr("value")){var c=a.getNodeByParam(f,u.attr("value"),null);a.selectNode(c),c&&(r.val(c[l]).trigger("change"),v.css("color","red"))}}n.onAsyncSuccess&&n.onAsyncSuccess.toFunc().call(this,t,i,s,o)}}},n);m.click(function(){d()}),r.keypress(function(e){e.keyCode==13&&d()}),r.click(function(){d()}),v.click(function(){r.val(""),u.val(""),a.length==1&&a.val(""),e(this).css("color","#ccc")});var b=y.tree(s);r.treeObj=b}),r},e.fn.typeaHead=function(t){var n=e.extend(!0,{autoSelect:!0},t),r=e(this);r.typeahead(n)},e.fn.summerNote=function(r){var i=e(this);require(["jquery/summernote"],function(){var s=e.extend(!0,{toolbar:[["style",["bold","italic","underline","color","clear","strikethrough","superscript","subscript","fontsize","height"]],["para",["ul","ol","paragraph"]],["insert",["picture","link","video","table","hr"]],["misc",["undo","redo","codeview"]]],lang:"zh-CN",placeholder:i.data("placeholder")||"",minHeight:200,dialogsFade:!0,dialogsInBody:!0,disableDragAndDrop:!0,callbacks:{onImageUpload:function(e){var s=n.getServerByKey(r.fileServer),o=new FormData;o.append("file",e[0]),n.uploadFile(s,o,{type:"_rich_edit_",ownerid:t.getUniqueID("565")},function(e){i.summernote("insertImage",s.fileSrvUrl+e.url,function(t){t.css({width:t.width()/3,height:t.height()/3}),t.attr("data-fileid",e.id)})})}}},r);i.summernote(s)})},e.fn.fileUpload=function(r,i){var s=e(this),o=s.closest("div.files-box");if(o.length!=1){alert("\u6587\u4ef6\u4e0a\u4f20\u63a7\u4ef6\u6ca1\u6709class\u4e3afiles-box\u7684div\u7236\u6807\u7b7e");return}r.maxFiles==undefined&&(r.maxFiles=5),r.col==undefined&&(r.col=4),r.savePath&&(r.maxFiles=1);var u=n.getServerByKey(r.fileServer);if(s.attr("type")!="hidden"){alert("\u6587\u4ef6\u4e0a\u4f20\u63a7\u4ef6\u5fc5\u987b\u4e3a\u9690\u85cf\u63a7\u4ef6");return}o.children("div.file-upload-zone").length==0&&o.append("<div class='row file-upload-zone'><div class='col-md-"+r.col+"'>"+"<a class='btn btn-primary fileinput-button'><input type='file' name='_upload_file_'>"+"\u9009\u62e9\u6587\u4ef6 <i class='fa fa-upload fa-lg'></i> </a></div></div>");var a=o.find("[name='_upload_file_']:file"),f=o.find(".fileinput-button");if(!t.isEmpty(s.data("original"))){var l=s.data("original");s.val(l);if(r.savePath){r.param.ownerid=t.getUniqueID("200"),r.param.path=l.replace(u.fileSrvUrl,"");var c=u.getFileListParam(r.param);n.ajax(u.getFileListUrl(),c,!1,function(e){var t=u.respFile(e);b(t,u,o,r,i)})}else{r.param.ownerid=l;var c=u.getFileListParam(r.param);n.ajax(u.getFileListUrl(c),c,!1,function(e){var t=u.respFile(e);b(t,u,o,r,i)})}}else{var l=t.getUniqueID("100");r.param.ownerid=l,r.savePath||s.val(l),f.show()}require(["jquery/fileupload"],function(){var s=u.getFileUploadUrl(r.param||{}),l=u.getUrl(s),c="",h=e.extend(!0,{url:u.srvUrl+l,dataType:"json",maxFileSize:4e6,paramName:u.fileParamName,formData:function(e){var t=new FormData;return t.append(u.fileParamName,a),t},beforeSend:function(e){return n.createHeader(u,l,e,i)},send:function(e,t){return f.hide(),o.find("[title='"+t.files[0].name+"']").length>0?(c="\u76f8\u540c\u540d\u79f0\u6587\u4ef6\u5df2\u5b58\u5728",!1):!0},done:function(e,t){f.show();var n=u.respFile(t.result);b(n,u,o,r,i)},fail:function(e,n){f.show(),t.notice("\u6587\u4ef6\u4e0a\u4f20\u9519\u8bef",n.textStatus||c,"error")},progressall:function(e,n){var r=t.progressBar(o),i=parseInt(n.loaded/n.total*100,10);r.go(i)}},r);a.fileupload(h).prop("disabled",!e.support.fileInput).parent().addClass(e.support.fileInput?undefined:"disabled")})},i.queryForm=function(n,r){var i={queryForm:!0,url:n.url};if(n.queryForm)e(n.queryForm).initForm(i,function(e){typeof r=="function"&&r.call(this,e)});else if(n.queryModal){var s={title:"<i class='fa fa-search'/></i> \u67e5\u8be2",clear:!1,show:!1,buttons:{text:"\u67e5\u8be2",classes:"btn-primary",action:function(e,t,n){n.find("form").submit()}}},o={};typeof n.queryModal=="string"?o=e.extend(s,{id:n.queryModal}):typeof n.queryModal=="object"&&(o=e.extend(!0,s,n.queryModal)),t.modal(o.id,o,function(){E(o.id,i,r)})}},i.editForm=function(n,r,i){var s=e.extend(!0,{submitClear:!1,initClear:!0,autoClose:!1},n);if(n.editForm)e(n.editForm).initForm(s,function(e){typeof r=="function"&&r.call(this,e)},function(e){typeof i=="function"&&i.call(this,data)});else if(n.editModal){s.title="<i class='fa fa-edit'/></i> "+(n.title||"");var o={title:s.title,show:!0,buttons:s.isView?null:{text:"\u4fdd\u5b58",classes:"btn-primary",action:function(e,t,n){n.find("form").submit()}}},u={};typeof n.editModal=="string"?u=e.extend(o,{id:n.editModal}):typeof n.editModal=="object"&&(u=e.extend(!0,o,n.editModal)),t.modal(u.id,u,function(){E(u.id,s,r,i)})}},e.fn.field=function(t){return e(this).find("[name='"+t+"']")},i}),define("app/datatables",["jquery","app/common","app/api","datatables.net","datatables/buttons/flash","datatables/buttons/print","datatables/select","datatables/responsive","datatables/fixedHeader","css!lib/jquery/datatables/dataTables.bootstrap.css"],function(e,t,n,r){function a(n,r,i,s){var o=r.init();if(typeof o[s+"Record"]=="function")o[s+"Record"].call(this,r,i,n);else if(!t.isEmpty(o.addModal)||!t.isEmpty(o.addEditModal)||!t.isEmpty(o.editModal)){var u=o.addEditModal||o.addModal||o.editModal;if(u.url&&u.id){var a=u.url;t.isEmpty(o.addEditModal)||(u.url.indexOf("?")>0?a=u.url+"&act="+s:a=u.url+"?act="+s);var f=e.extend(!0,{buttons:s=="view"?null:[{text:"\u4fdd\u5b58",classes:"btn-primary",action:function(e,t,n){n.find("form").submit()}}],params:{act:s,table:r}},u);f.url=a,t.modal(u.id,f)}else alert("\u8bf7\u6307\u5b9amodal\u7684url\u548cid\u5c5e\u6027")}else if(!t.isEmpty(o.addForm)||!t.isEmpty(o.addEditForm)||!t.isEmpty(o.editForm)){var l=o.addEditForm||o.addForm||o.editForm,c=e.extend(!0,{},{formData:s=="edit"||s=="view"?r.selectedRows()[0]:null,submitClear:s!="edit",autoClose:s=="edit",isView:s=="view"},l);l[s+"Validate"]&&(typeof l[s+"Validate"]=="object"?c.validate=l[s+"Validate"]:typeof l[s+"Validate"]=="function"&&(c.validate=l[s+"Validate"].call(this,r)));if(l[s+"Url"]!==undefined||l.url!==undefined||e(l.id).attr("action")!==undefined)c.url=l[s+"Url"]||l.url||e(l.id).attr("action")+"/"+s;require(["app/form"],function(e){e.editForm(c,function(e){typeof l.submitCallback=="function"?l.submitCallback.call(this,e):(s=="add"&&r.addRow(e),s=="edit"&&r.updateSelectedRow(e))})})}else alert("\u8bf7\u521d\u59cb\u5316\u8868\u683c\u53c2\u6570\u4e2d\u7684addForm|addEditForm|addModal|addEditModal|addRecord|editRecord|viewRecord\u9009\u9879")}function f(e,r,i){if(r.selectedCount()<1){t.info("\u8bf7\u9009\u62e9\u9700\u8981\u5220\u9664\u7684\u8bb0\u5f55");return}var s=r.init();typeof s.deleteRecord=="function"?s.deleteRecord.call(this,r,i,e):t.confirm("","\u662f\u5426\u5220\u9664\u9009\u62e9\u7684\u8bb0\u5f55?",function(){if(!t.isEmpty(s.deleteRecord)&&!t.isEmpty(s.deleteRecord.url)){var e=s.deleteRecord.id?s.deleteRecord.id:"id",i=s.deleteRecord.row?r.selectedRowsData(e):r.selectedColumnData(e);n.ajax(s.deleteRecord.url,i,!1,function(e,i){n.isError(e)?t.error(e):(r.deleteSelectedRow(),t.success(n.respMsg(e),null,!0)),typeof s.deleteRecord.onDeleted=="function"&&s.deleteRecord.onDeleted.call(this,e)},function(e){t.error(e)})}else r.deleteSelectedRow(),t.success(n.respMsg("\u8bb0\u5f55\u5df2\u5220\u9664"),null,!0)})}function l(r,i,s){t.isEmpty(i.dataUrl)&&(i.dataUrl=r.data("url"));var o={};i.params&&(o=i.params);if(e.isArray(i.rowOperation)&&e.isArray(i.columns)){var u="";for(var a=0;a<i.rowOperation.length;a++){var f=i.rowOperation[a];typeof i.rowOperation[a]=="string"?f={operation:f,text:"<i class='iconfont icon-"+f+"' style='font-size:1.5em'></i>",title:f=="edit"?"\u4fee\u6539":f=="delete"?"\u5220\u9664":"\u67e5\u770b"}:(f.icon&&(f.text="<i class='"+f.icon+"' style='font-size:1.5em'></i>"),f.title===undefined&&(f.title="")),u+="<a data-operation='dt-"+f.operation+"' title='"+f.title+"'>"+f.text+"</a> "}i.columns.push({data:null,orderable:!1,title:"\u64cd\u4f5c",defaultContent:u})}if(e.isArray(i.columns)){e.isArray(i.footer)&&r.children("tfoot").length==0&&r.append("<tfoot><tr></tr></tfoot>");for(var a=0;a<i.columns.length;a++){i.tableType=="treetable"&&(i.columns[a].orderable=!1),i.columns[a].name===undefined&&(i.columns[a].name=i.columns[a].data);if(e.isArray(i.footer)){var l=e("<th></th>");for(var c=0;c<i.footer.length;c++)if(i.columns[a].name==i.footer[c].data){i.footer[c].title&&l.html(i.footer[c].title),i.footer[c].type&&l.attr("data-"+i.footer[c].type+"-column",a),i.footer[c].format&&l.attr("data-format",i.footer[c].format);break}r.find("tfoot>tr").append(l)}}i.tableType=="treetable"&&(i.ordering=!0,i.columns.push({data:"treeSort",visible:!1,name:"treeSort"}),i.order=[[i.columns.length-1,"asc"]],e.isArray(i.footer)&&r.find("tfoot>tr").append("<th></th>"))}else{var h=new Array;r.find("thead th[data-column]").each(function(t){var n=e(this).data("column");n==="dt-detail"?h.push({data:null,orderable:!1,defaultContent:"<a dt-detail><i class='iconfont icon-chevronright'></i></a>"}):n===""?h.push({data:null,defaultContent:"",orderable:!1}):n==="select-checkbox"?h.push({data:null,defaultContent:""}):h.push({data:n})}),i.columns=h}if(i.dataUrl!=undefined)if(i.serverSide)i.ajax={url:i.dataUrl,data:function(e){return e.order&&e.order.length===1&&(o.orderBy=h[e.order[0].column].data+" "+e.order[0].dir),o.pageNO=e.start/e.length+1,o.pageSize=e.length<0?0:e.length,o.tableDraw=e.draw,o},dataSrc:function(e){return e.recordsFiltered=e.recordsTotal,e.data}},i.searching=!1,s(r.DataTable(i));else{var p=r.DataTable(i);t.blockUI({target:r.get(),gif:"load-tables"}),setTimeout(function(){n.ajax(i.dataUrl,o,!1,function(e,i){p.rows.add(n.respData(e)).draw(),t.unblockUI(r.get()),s(p)},function(e){t.unblockUI(r.get()),t.notice("\u7cfb\u7edf\u9519\u8bef","\u8868\u683c\u6570\u636e\u83b7\u53d6\u9519\u8bef:"+n.respMsg(e),"error")})},200)}else s(r.DataTable(i))}var i={pdf:{icon:"<i class='fa fa-file-pdf-o'></i> ",text:"\u5bfc\u51faPDF"},copy:{icon:"<i class='fa fa-copy'></i> ",text:"\u590d\u5236"},excel:{icon:"<i class='fa fa-file-excel-o'></i> ",text:"\u5bfc\u51fa"},print:{icon:"<i class='fa fa-print'></i> ",text:"\u6253\u5370"}},s={dom:"B<'dataTables_filter'><'table-scrollable'tr<'table-foot-bar' ilp>>",oLanguage:{sLengthMenu:"_MENU_/\u9875",sSearch:"<div class='input-icon input-icon-sm'><i class='iconfont icon-search'></i>_INPUT_</div>",sInfo:" _START_-_END_ \u5171_TOTAL_\u6761\u8bb0\u5f55",sLoadingRecords:"",sProcessing:"<img src='"+t.imgPath+"/load-tables.gif' />",sInfoEmpty:"0/0 \u5171 0\u6761\u8bb0\u5f55",sInfoFiltered:"",sZeroRecords:"\u6ca1\u6709\u6570\u636e",sEmptyTable:"\u6ca1\u6709\u6570\u636e",buttons:{pdf:i.pdf.icon+i.pdf.text,copy:i.copy.icon+i.copy.text,copyTitle:"\u590d\u5236\u5230\u526a\u8d34\u677f",copyInfo:{_:"\u4ee5\u590d\u5236 %d \u884c\u5230\u526a\u8d34\u677f",1:"\u590d\u5236 1 \u884c\u5230\u526a\u8d34\u677f"},excel:i.excel.icon+i.excel.text,print:i.print.icon+i.print.text},oPaginate:{sNext:">",sPrevious:"<",sFirst:"",sLast:""}},renderer:"bootstrap"};e.extend(!0,r.defaults,s),e.fn.dataTableExt.oStdClasses.sWrapper=e.fn.dataTableExt.oStdClasses.sWrapper+" dataTables_extended_wrapper",e.fn.dataTableExt.oStdClasses.sFilterInput="form-control input-sm";var o=r.Responsive.display,u=o.modal;return o.modal=function(t){return function(n,r,i){if(!e.fn.modal)u(n,r,i);else if(!r){var s=e('<div class="modal fade" role="dialog"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button></div><div class="modal-body"/></div>');t&&t.header&&s.find("div.modal-header").append('<h4 class="modal-title">'+t.header(n)+"</h4>"),s.find("div.modal-body").append(i()),s.appendTo("body").modal("show")}}},r.ext.sErrMode=function(e,n,r){t.notice("\u8868\u683c\u9519\u8bef\u4fe1\u606f",r,"error")},r.ext.renderer.pageButton.bootstrap=function(t,n,i,s,o,u){var a=new r.Api(t),f=t.oClasses,l=t.oLanguage.oPaginate,c,h,p=function(n,r){var s,d,v,m,g=function(t){t.preventDefault(),e(t.currentTarget).hasClass("disabled")||a.page(t.data.action).draw(!1)};for(s=0,d=r.length;s<d;s++){m=r[s];if(e.isArray(m))p(n,m);else{c="",h="";switch(m){case"ellipsis":c="&hellip;",h="disabled";break;case"first":c=l.sFirst,h=m+(o>0?"":" disabled");break;case"previous":c=l.sPrevious,h=m+(o>0?"":" disabled");break;case"next":c=l.sNext,h=m+(o<u-1?"":" disabled");break;case"last":c=l.sLast,h=m+(o<u-1?"":" disabled");break;default:c=m+1,h=o===m?"active":""}c&&(v=e("<li>",{"class":f.sPageButton+" "+h,"aria-controls":t.sTableId,tabindex:t.iTabIndex,id:i===0&&typeof m=="string"?t.sTableId+"_"+m:null}).append(e("<a>",{href:"#"}).html(c)).appendTo(n),t.oApi._fnBindAction(v,{action:m},g))}}};p(e(n).empty().html('<ul class="pagination pagination-sm"/>').children("ul"),s)},e.extend(!0,r.Buttons.defaults,{dom:{container:{className:"dt-buttons btn-group"},button:{tag:"a",className:"btn btn-sm btn-info"},buttonLiner:{tag:"",className:""},collection:{tag:"ul role='menu'",className:"dt-button-collection dropdown-menu",button:{tag:"li",className:"dt-button"},buttonLiner:{tag:"a",className:""}}}}),r.Api.register("buttons.info()",function(e,n,r){var i=this;return t.notice(e,n,"info"),this}),r.Buttons.swfPath=t.jsPath+"/lib/jquery/datatables/swf/flashExport.swf",e.fn.dataTable.ext.buttons.addRecord={text:"<i class='fa fa-copy'></i> \u65b0\u589e",className:"btn btn-sm btn-primary",action:function(e,t,n,r){a(e,t,n,"add")}},e.fn.dataTable.ext.buttons.editRecord={text:"<i class='fa fa-edit'></i> \u4fee\u6539",className:"btn btn-sm btn-primary btn-selectOne",action:function(e,n,r,i){if(n.selectedCount()!=1){t.info("\u8bf7\u9009\u62e9\u4e00\u6761\u9700\u8981\u4fee\u6539\u7684\u8bb0\u5f55");return}a(e,n,r,"edit")}},e.fn.dataTable.ext.buttons.viewRecord={text:"<i class='fa fa-eye'></i> \u67e5\u770b",className:"btn btn-sm btn-primary btn-selectOne",action:function(e,n,r,i){if(n.selectedCount()!=1){t.info("\u8bf7\u9009\u62e9\u4e00\u6761\u9700\u8981\u67e5\u770b\u7684\u8bb0\u5f55");return}a(e,n,r,"view")}},e.fn.dataTable.ext.buttons.deleteRecord={text:"<i class='fa fa-trash-o'></i> \u5220\u9664",className:"btn btn-sm btn-warning btn-selectMore",action:function(e,t,n,r){f(e,t,n)}},r.getTable=function(t){return new e.fn.dataTable.Api(t)},e.fn.initTable=function(n,i){var s=e(this);n===undefined&&(n={});var o=s.attr("id");if(t.isEmpty(o)){alert("\u8bf7\u6307\u5b9atable id");return}r.getTable("#"+o).destroy();var u=e.extend(!0,{tableId:o,processing:!0,serverSide:!1,paging:!0,info:!0,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"\u5168\u90e8"]],pageLength:10,autoWidth:!0,permission:!0,scrollCollapse:!0,select:{style:"os",info:!1},scrollY:"",scrollX:!1,buttons:[],createdRow:function(e,t,n){},footerCallback:function(r,i,s,u,a){if(r){u==0?e("div#"+o+"_wrapper div.dataTables_scrollFoot").hide():e("div#"+o+"_wrapper div.dataTables_scrollFoot").show();var f=this.api();e(r).children("th[data-sum-column]").each(function(){var n=e(this).data("sum-column"),r=f.column(n,{page:"current"}).data().reduce(function(e,n){return t.numeral(e).value()+t.numeral(n).value()},0),i=e(this).data("format")?e(this).data("format"):"0";if(f.page.info()&&f.page.info().pages>1){var s=f.column(n).data().reduce(function(e,n){return t.numeral(e).value()+t.numeral(n).value()},0);e(f.column(n).footer()).html(t.numeral(r).format(i)+"/"+t.numeral(s).format(i))}else e(f.column(n).footer()).html(t.numeral(r).format(i))}),e(r).children("th[data-count-column]").each(function(){var t=e(this).data("count-column"),n=f.column(t,{page:"current"}).data().count();if(f.page.info()&&f.page.info().pages>1){var r=f.column(t).data().count();e(f.column(t).footer()).html(n+"/"+r)}else e(f.column(t).footer()).html(n)}),typeof n.footerFormat=="function"&&n.footerFormat.call(this,f,r,i,s,u,a)}},headerCallback:function(e,t,r,i,s){if(typeof n.headerFormat=="function"){var o=this.api();n.headerFormat.call(this,o,e,t,r,i,s)}},initComplete:function(r,i){t.unblockUI(s.get());var u=s.dataTable().api();if(r.searching==undefined||r.searching){var a="<label><div class='input-icon left'><input type='search' class='form-control input-sm' placeholder='\u8bf7\u8f93\u5165\u641c\u7d22\u5185\u5bb9' aria-controls='"+o+"'>"+"<i class='iconfont icon-search'></i></div></label>",f=e("div#"+o+"_wrapper .dataTables_filter");f.html(a),f.on("keyup","input",function(e){(e.keyCode==13||e.keyCode==8&&this.value.length==0)&&u.search(this.value).draw()}),f.on("click",".icon-search",function(t){var n=e(this).prev("input");n.val().length>0&&u.search(n.val()).draw()}),n.queryModal?require(["app/form"],function(t){var r=e("<button class='btn btn-sm green' style='margin-bottom: 2px;'><i class='fa fa-ellipsis-h fa-lg'/></i></button>"),i=n.queryModal;typeof n.queryModal=="object"&&(i=n.queryModal.id),t.queryForm({url:s.data("url"),queryModal:n.queryModal},function(e,t){u.clear().draw(),u.rows.add(e).draw(),typeof t=="function"&&t()}),r.on("click",function(){e(i).modal("show")}),f.find(".input-icon").append(r),r.tooltip({title:"\u66f4\u591a\u67e5\u8be2\u6761\u4ef6",placement:"auto left"})}):f.css("margin-right","0")}e("div#"+o+"_wrapper div.dataTables_scroll").children().css("width","100%")}},n);if(u.checkboxSelect){var c=[{orderable:!1,width:"0.7em",className:"select-checkbox",targets:0}];u=e.extend(u,{select:{style:"multi",selector:"td:first-child",info:!1}},!0),(u.ordering||s.data("ordering"))&&!e.isArray(u.order)&&(u.order=[[1,"asc"]]),e.isArray(u.columnDefs)?u.columnDefs=c.concat(u.columnDefs):u.columnDefs=c;if(e.isArray(u.columns))u.columns=[{data:null,defaultContent:"",title:"<i class='fa fa-square-o'></i>"}].concat(u.columns);else{var h=e("<th data-column='select-checkbox'><i class='fa fa-square-o'></i></th>");s.find("thead>tr").prepend(h)}}return u.buttons=[],e("#"+(u.toolbar?u.toolbar:o+"-toolbar")).children().each(function(){var t=e(this),n=t.data("role");t.html()!=""?u.buttons.push({text:t.html(),className:t.attr("class"),action:function(e,r,i,s){n=="addRecord"?a(e,r,i,"add"):n=="editRecord"?a(e,r,i,"edit"):n=="viewRecord"?a(e,r,i,"view"):n=="deleteRecord"?f(e,r,i):typeof u[t.data("role")]=="function"&&u[t.data("role")].call(this,r,i,e)}}):u.buttons.push(n),t.remove()}),l(s,u,function(n){var r=e("div#"+o+"_wrapper>div.dt-buttons"),l=r.children(".btn-selectOne"),c=r.children(".btn-selectMore");t.disableBtn(l),t.disableBtn(c),n.on("draw.dt",function(){n.selectedCount()==0&&(t.disableBtn(l),t.disableBtn(c))}),n.on("select",function(e,r,i,s){i==="row"&&(t.enableBtn(c),n.selectedCount()==1?t.enableBtn(l):t.disableBtn(l))}),n.on("deselect",function(e,r,i,s){i==="row"&&(n.selectedCount()==1?t.enableBtn(l):n.selectedCount()>1?(t.disableBtn(l),t.enableBtn(c)):(t.disableBtn(l),t.disableBtn(c)))});if(u.scrollY){var h=e("div#"+o+"_wrapper .dataTables_scrollBody");h.height()>s.height()?(e("div#"+o+"_wrapper .dataTables_scrollHeadInner").css({width:"100%"}),e("div#"+o+"_wrapper .dataTables_scrollHeadInner table").css({width:"100%"})):u.tableType=="treetable"&&h.css("overflow-y","scroll")}s.on("click","td a[dt-detail]",function(){var r=n.row(e(this).closest("td"));n.rows().deselect(),r.select(),u.detailPage&&t.loadInnerPage(t.getPageContainer(s),u.detailPage,r)}),e.isArray(u.rowOperation)&&s.on("click","td a[data-operation^='dt-']",function(t){var r=n.row(e(this).closest("td"));n.rows().deselect(),r.select();var i=e(this).data("operation").replace("dt-","");i=="edit"?a(t,n,e(this),"edit"):i=="delete"?f(t,n,e(this)):i=="view"?a(t,n,e(this),"view"):typeof u[i]=="function"&&u[i].call(this,n,e(this),t)}),u.checkboxSelect&&e(n.column(".select-checkbox").header()).click(function(){if(n.rows().count()>0){var t=e(this).children("i");t.hasClass("fa-square-o")?(n.rows().select(),t.removeClass("fa-square-o").addClass("fa-check-square-o")):(n.rows().deselect(),t.removeClass("fa-check-square-o").addClass("fa-square-o"))}}),i&&typeof i=="function"&&i(n)})},r.Api.register("dataCount()",function(){return this.data().count()}),r.Api.register("selectedRows()",function(){return this.rows(".selected").data()}),r.Api.register("selectedRowsData()",function(e){var n=this.rows(".selected").data(),r=new Array;for(var i=0;i<n.length;i++)if(t.isEmpty(e))r.push(n[i]);else{var s={};s[e]=n[i][e],r.push(s)}return r}),r.Api.register("tableData()",function(e){var n=this.rows().data(),r=new Array;for(var i=0;i<n.length;i++)if(t.isEmpty(e))r.push(n[i]);else{var s={};s[e]=n[i][e],r.push(s)}return r}),r.Api.register("columnData()",function(e){return this.column(e+":name").data()}),r.Api.register("selectedColumnData()",function(e){var t=this.rows(".selected"),n=[];for(var r=0;r<t.count();r++)n.push(t.data()[r][e]);return n}),r.Api.register("query()",function(r,i){var s=this,o=s.init();r&&(o.params=r);var u=e("#"+o.tableId).get();o.tableType!="treetable"&&(s.clear().draw(),t.blockUI({target:u,gif:"load-tables"}),n.ajax(o.dataUrl,o.params,!0,function(e,r){s.rows.add(n.respData(e)).draw(),t.unblockUI(u)}))}),r.Api.register("addRow()",function(t){var n=this.row.add(t).draw();return this.init().tableType=="treetable"&&(this.search("").draw(),e(this.table().node()).treetable("move",n.node(),t.parentId)),n}),r.Api.register("updateSelectedRow()",function(n){var r=this.row(this.rows(".selected")[0]).data(n);if(this.init().tableType=="treetable"){var i=e(this.table().node()),s=i.treetable("node",n.id);s.treeCell.prepend(s.indenter),s.render(),e(this.table().node()).treetable("move",n.id,n.parentId),this.rows(function(e,t,r){return t.parentTree.indexOf(n.id)>0?!0:!1}).every(function(e,r,o){var u=this.data(),a=u.parentIds.indexOf(n.id),f=u.parentIds.substring(0,a),l=t.isEmpty(n.parentIds)?"'":n.parentIds+",'";u.parentIds=u.parentIds.replace(f,l);var c=u.parentTree.indexOf(n.id);f=u.parentTree.substring(0,c);var h=t.isEmpty(n.parentTree)?n.sort+"-":n.parentTree+","+n.sort+"-";u.parentTree=u.parentTree.replace(f,h),u.treeSort=u.treeSort.replace(f,h),this.data(u),s=i.treetable("node",u.id),s.treeCell.prepend(s.indenter),s.render()})}return r.draw()}),r.Api.register("deleteSelectedRow()",function(){var t=this,n=t.table().node();t.init().tableType=="treetable"&&t.rows(".selected").every(function(r,i,s){if(this.data()&&this.data().id){var o=this.data().id;e(n).treetable("removeNode",o),t.rows(function(e,t,n){return t.parentTree.indexOf(o)>0?!0:!1}).remove()}}),t.rows(".selected").remove().draw()}),r.Api.register("selectedCount()",function(){return this.rows(".selected").count()}),r.Api.register("sum()",function(){return this.flatten().reduce(function(e,t){return typeof e=="string"&&(e=e.replace(/[^\d.-]/g,"")*1),typeof t=="string"&&(t=t.replace(/[^\d.-]/g,"")*1),e+t},0)}),r}),define("app/treetable",["jquery","app/common","app/datatables"],function(e,t,n){var r,i,s;return r=function(){function t(t,n,r){var i;this.row=t,this.tree=n,this.settings=r,this.id=this.row.data(this.settings.nodeIdAttr),i=this.row.data(this.settings.parentIdAttr),i!=null&&i!==""&&(this.parentId=i),this.treeCell=e(this.row.children(this.settings.columnElType)[this.settings.column]),this.expander=e(this.settings.expanderTemplate),this.indenter=e(this.settings.indenterTemplate),this.children=[],this.initialized=!1,this.treeCell.prepend(this.indenter)}return t.prototype.addChild=function(e){return this.children.push(e)},t.prototype.ancestors=function(){var e,t;t=this,e=[];while(t=t.parentNode())e.push(t);return e},t.prototype.collapse=function(){return this.collapsed()?this:(this.row.removeClass("expanded").addClass("collapsed"),this._hideChildren(),this.expander.attr("title",this.settings.stringExpand),this.initialized&&this.settings.onNodeCollapse!=null&&this.settings.onNodeCollapse.apply(this),this)},t.prototype.collapsed=function(){return this.row.hasClass("collapsed")},t.prototype.expand=function(){return this.expanded()?this:(this.row.removeClass("collapsed").addClass("expanded"),this.initialized&&this.settings.onNodeExpand!=null&&this.settings.onNodeExpand.apply(this),e(this.row).is(":visible")&&this._showChildren(),this.expander.attr("title",this.settings.stringCollapse),this)},t.prototype.expanded=function(){return this.row.hasClass("expanded")},t.prototype.hide=function(){return this._hideChildren(),this.row.hide(),this},t.prototype.isBranchNode=function(){return this.children.length>0||this.row.data(this.settings.branchAttr)===!0?!0:!1},t.prototype.updateBranchLeafClass=function(){this.row.removeClass("branch"),this.row.removeClass("leaf"),this.row.addClass(this.isBranchNode()?"branch":"leaf")},t.prototype.level=function(){return this.ancestors().length},t.prototype.parentNode=function(){return this.parentId!=null?this.tree[this.parentId]:null},t.prototype.removeChild=function(t){var n=e.inArray(t,this.children);return this.children.splice(n,1)},t.prototype.render=function(){var t,n=this.settings,r;return n.expandable===!0&&this.isBranchNode()&&(t=function(t){return e(this).parents("table").treetable("node",e(this).parents("tr").data(n.nodeIdAttr)).toggle(),t.preventDefault()},this.indenter.html(this.expander),r=n.clickableNodeNames===!0?this.treeCell:this.expander,r.off("click.treetable").on("click.treetable",t),r.off("keydown.treetable").on("keydown.treetable",function(e){e.keyCode==13&&t.apply(this,[e])})),this.children.length===0&&this.indenter.html(""),this.indenter[0].style.paddingLeft=""+this.level()*n.indent+"px",this},t.prototype.reveal=function(){return this.parentId!=null&&this.parentNode().reveal(),this.expand()},t.prototype.setParent=function(e){return this.parentId!=null&&this.tree[this.parentId].removeChild(this),this.parentId=e.id,this.row.data(this.settings.parentIdAttr,e.id),e.addChild(this)},t.prototype.show=function(){return this.initialized||this._initialize(),this.row.show(),this.expanded()&&this._showChildren(),this},t.prototype.toggle=function(){return this.expanded()?this.collapse():this.expand(),this},t.prototype._hideChildren=function(){var e,t,n,r,i;r=this.children,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.hide());return i},t.prototype._initialize=function(){var e=this.settings;return this.render(),e.expandable===!0&&e.initialState==="collapsed"?this.collapse():this.expand(),e.onNodeInitialized!=null&&e.onNodeInitialized.apply(this),this.initialized=!0},t.prototype._showChildren=function(){var e,t,n,r,i;r=this.children,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.show());return i},t}(),i=function(){function t(e,t){this.table=e,this.settings=t,this.tree={},this.nodes=[],this.roots=[]}return t.prototype.collapseAll=function(){var e,t,n,r,i;r=this.nodes,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.collapse());return i},t.prototype.expandAll=function(){var e,t,n,r,i;r=this.nodes,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.expand());return i},t.prototype.findLastNode=function(e){return e.children.length>0?this.findLastNode(e.children[e.children.length-1]):e},t.prototype.loadRows=function(t){var n,i,s;if(t!=null)for(s=0;s<t.length;s++)i=e(t[s]),i.data(this.settings.nodeIdAttr)!=null&&(n=new r(i,this.tree,this.settings),this.nodes.push(n),this.tree[n.id]=n,n.parentId!=null&&this.tree[n.parentId]?this.tree[n.parentId].addChild(n):this.roots.push(n));for(s=0;s<this.nodes.length;s++)n=this.nodes[s].updateBranchLeafClass();return this},t.prototype.move=function(t,n){var r=t.parentNode();return n==undefined||n==null||n==""?r&&(r.removeChild(t),t.parentId=null,t.row.data(t.settings.parentIdAttr,null),t.render(),this._moveRows(t,null)):t!==n&&n.id!==t.parentId&&e.inArray(t,n.ancestors())===-1&&(t.setParent(n),this._moveRows(t,n),t.parentNode().children.length===1&&t.parentNode().render()),r&&(r.updateBranchLeafClass(),r.children.length===0&&r.render()),t.parentNode()&&t.parentNode().updateBranchLeafClass(),t.updateBranchLeafClass(),this},t.prototype.removeNode=function(t){return this.unloadBranch(t),t.row.remove(),t.parentId!=null&&(t.parentNode().removeChild(t),t.parentNode().children.length===0&&t.parentNode().indenter.html("")),delete this.tree[t.id],this.nodes.splice(e.inArray(t,this.nodes),1),this},t.prototype.render=function(){var e,t,n,r;r=this.roots;for(t=0,n=r.length;t<n;t++)e=r[t],e.show();return this},t.prototype.sortBranch=function(e,t){return e.children.sort(t),this._sortChildRows(e),this},t.prototype.unloadBranch=function(e){var t=e.children.slice(0),n;for(n=0;n<t.length;n++)this.removeNode(t[n]);return e.children=[],e.updateBranchLeafClass(),this},t.prototype._moveRows=function(e,t){var n=e.children,r;t&&e.row.insertAfter(t.row),e.render();for(r=n.length-1;r>=0;r--)this._moveRows(n[r],e)},t.prototype._sortChildRows=function(e){return this._moveRows(e,e)},t}(),s={init:function(t,n){var r;return r=e.extend({branchAttr:"ttBranch",clickableNodeNames:!1,column:0,columnElType:"td",expandable:!1,expanderTemplate:"<a href='#'>&nbsp;</a>",indent:20,indenterTemplate:"<span class='indenter'></span>",initialState:"collapsed",nodeIdAttr:"ttId",parentIdAttr:"ttParentId",stringExpand:"\u5c55\u5f00",stringCollapse:"\u6536\u8d77",onInitialized:null,onNodeCollapse:null,onNodeExpand:null,onNodeInitialized:null},t),this.each(function(){var t=e(this),s;if(n||t.data("treetable")===undefined)s=new i(this,r),s.loadRows(this.rows).render(),t.addClass("treetable").data("treetable",s),r.onInitialized!=null&&r.onInitialized.apply(s);return t})},destroy:function(){return this.each(function(){return e(this).removeData("treetable").removeClass("treetable")})},collapseAll:function(){return this.data("treetable").collapseAll(),this},collapseNode:function(e){var t=this.data("treetable").tree[e];if(!t)throw new Error("Unknown node '"+e+"'");return t.collapse(),this},expandAll:function(){return this.data("treetable").expandAll(),this},expandNode:function(e){var t=this.data("treetable").tree[e];if(!t)throw new Error("Unknown node '"+e+"'");return t.initialized||t._initialize(),t.expand(),this},loadBranch:function(t,n){var r=this.data("treetable").settings,i=this.data("treetable").tree;n=e(n);if(t==null)this.append(n);else{var s=this.data("treetable").findLastNode(t);n.insertAfter(s.row)}return this.data("treetable").loadRows(n),n.filter("tr").each(function(){i[e(this).data(r.nodeIdAttr)].show()}),t!=null&&t.render().expand(),this},move:function(t,n){var r,i;r=this.data("treetable").tree[n];if(typeof t=="object"){this.data("treetable").loadRows([t]);var s=e(t).data(this.data("treetable").settings.nodeIdAttr);i=this.data("treetable").tree[s]}else i=this.data("treetable").tree[t];if(r){r.initialized||r._initialize();var o=r.parentNode();while(o!=null)o.initialized||o._initialize(),o.expand(),o=o.parentNode();r.children.length>=1&&r.collapse(),r.expand()}return this.data("treetable").move(i,r),typeof t=="object"&&r&&r.children.length===1&&r.render(),this},node:function(e){return this.data("treetable").tree[e]},removeNode:function(e){var t=this.data("treetable").tree[e];if(!t)throw new Error("Unknown node '"+e+"'");return this.data("treetable").removeNode(t),this},reveal:function(e){var t=this.data("treetable").tree[e];if(!t)throw new Error("Unknown node '"+e+"'");return t.reveal(),this},sortBranch:function(t,n){var r=this.data("treetable").settings,i,s;return n=n||r.column,s=n,e.isNumeric(n)&&(s=function(t,r){var i,s,o;return i=function(t){var r=t.row.find("td:eq("+n+")").text();return e.trim(r).toUpperCase()},s=i(t),o=i(r),s<o?-1:s>o?1:0}),this.data("treetable").sortBranch(t,s),this},unloadBranch:function(e){return this.data("treetable").unloadBranch(e),this}},e.fn.treetable=function(t){var n=this;if(s[t])return s[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&!!t)return alert("\u65b9\u6cd5[ "+t+"]\u4e0d\u5b58\u5728");var r=e.extend(!0,{processing:!0,serverSide:!1,tableType:"treetable",language:{info:"\u5171_TOTAL_\u6761\u8bb0\u5f55",infoEmpty:""},createdRow:function(n,r,i){e(n).attr("data-tt-id",r[t.tid]),e(n).attr("data-tt-parent-id",r[t.tpid])}},t);r.paging=!1;var i=e(n),o=i.attr("id");i.initTable(r,function(i){var u=s.init.call(n,t);r.expandBtn&&(e("div#"+o+"_wrapper>.dt-buttons").prepend("<div class='btn-group'><button type='button' class='btn btn-sm btn-info dropdown-toggle' data-toggle='dropdown'><i class='fa fa-minus-square-o'></i> \u5c55\u5f00 <i class='fa fa-angle-down'></i></button><ul class='dropdown-menu' role='menu'><li><a href='#' id='"+o+"_expand_all'><i class='fa fa-minus-square'></i>&nbsp; \u5168\u90e8\u5c55\u5f00</a></li>"+"<li><a href='#' id='"+o+"_collapse_all'><i class='fa fa-plus-square'></i>&nbsp; \u5168\u90e8\u6536\u8d77</a></li></ul></div>"),e("#"+o+"_expand_all").click(function(){s.expandAll.apply(n)}),e("#"+o+"_collapse_all").click(function(){s.collapseAll.apply(n)}))})},this.TreeTable||(this.TreeTable={}),this.TreeTable.Node=r,this.TreeTable.Tree=i,n.TreeTable=this.TreeTable,n}),define("app/tree",["jquery","app/common","app/api","jquery/ztree"],function($,APP,API){var zt=$.fn.zTree,tools=zt._z.tools,consts=zt.consts,view=zt._z.view,data=zt._z.data,event=zt._z.event,$$=tools.$;$.fn.zTree._z.view.asyncNode=function(setting,node,isSilent,callback){var i,l;if(node&&!node.isParent)return tools.apply(callback),!1;if(node&&node.isAjaxing)return!1;if(tools.apply(setting.callback.beforeAsync,[setting.treeId,node],true)==0)return tools.apply(callback),!1;if(node){node.isAjaxing=!0;var icoObj=$$(node,consts.id.ICON,setting);icoObj.attr({style:"","class":consts.className.BUTTON+" "+consts.className.ICO_LOADING})}var tmpParam={};for(i=0,l=setting.async.autoParam.length;node&&i<l;i++){var pKey=setting.async.autoParam[i].split("="),spKey=pKey;pKey.length>1&&(spKey=pKey[1],pKey=pKey[0]),tmpParam[spKey]=node[pKey]}if(tools.isArray(setting.async.otherParam))for(i=0,l=setting.async.otherParam.length;i<l;i+=2)tmpParam[setting.async.otherParam[i]]=setting.async.otherParam[i+1];else for(var p in setting.async.otherParam)tmpParam[p]=setting.async.otherParam[p];var _tmpV=data.getRoot(setting)._ver;return API.ajax(tools.apply(setting.async.url,[setting.treeId,node],setting.async.url),setting.async.contentType.indexOf("application/json")>-1?JSON.stringify(tmpParam):tmpParam,!1,function(ret){if(_tmpV!=data.getRoot(setting)._ver)return;var msg=API.respData(ret),newNodes=[];try{!msg||msg.length==0?newNodes=[]:typeof msg=="string"?newNodes=eval("("+msg+")"):newNodes=msg}catch(err){newNodes=msg}node&&(node.isAjaxing=null,node.zAsync=!0),view.setNodeLineIcos(setting,node),newNodes&&newNodes!==""?(newNodes=tools.apply(setting.async.dataFilter,[setting.treeId,node,newNodes],newNodes),view.addNodes(setting,node,-1,newNodes?tools.clone(newNodes):[],!!isSilent)):view.addNodes(setting,node,-1,[],!!isSilent),setting.treeObj.trigger(consts.event.ASYNC_SUCCESS,[setting.treeId,node,msg]),tools.apply(callback)},function(e,t,n){if(_tmpV!=data.getRoot(setting)._ver)return;node&&(node.isAjaxing=null),view.setNodeLineIcos(setting,node),setting.treeObj.trigger(consts.event.ASYNC_ERROR,[setting.treeId,node,e,t,n])}),!0},$.fn.tree=function(e,t,n){var r=$(this),i=t,s=r.attr("id");if(APP.isEmpty(s))return alert("\u8bf7\u6307\u5b9atree\u7684id\u5c5e\u6027"),null;if(e){if(e.stmID&&e.async===undefined&&APP.isEmpty(t)){var o=e.url||API.urls.stmListUrl,u={};e.stmID&&(o+="/"+e.stmID+_CONFIG.HTTP.SUFFIX),e.param&&(u.param=e.param),e.async={enable:!0,otherParam:u,url:o,autoParam:["id"]}}e.view==undefined&&(e.view={}),e.view.showIcon==undefined&&(e.view.showIcon=!0)}var a=$.extend(!0,{view:{dblClickExpand:!0,nameIsHTML:!0,fontCss:function(e,t){return t.highlight?{color:"#428bca","font-weight":"bold"}:{color:"#333","font-weight":"normal"}}},data:{simpleData:{enable:!0}},callback:{onNodeCreated:function(t,n,r){e.view.showIcon&&r.icons&&$("#"+r.tId+"_a").addClass(r.icons.indexOf("iconfont")==0?"icon_fonts":"icons").find("> span.button").append('<i class="'+r.icons+'"></i>'),e.onNodeCreated&&e.onNodeCreated.call(this,t,n,r)},onCollapse:function(t,n,r){r.iconsClose&&$("#"+r.tId+"_ico").find("> i").attr("class",r.iconsClose),e.onCollapse&&e.onCollapse.call(this,t,n,r)},onExpand:function(t,n,r){r.icons&&r.iconsClose&&$("#"+r.tId+"_ico").find("> i").attr("class",r.icons),e.onExpand&&e.onExpand.call(this,t,n,r)}}},e),f=$.fn.zTree.init(r,a,i);if(a.queryTools){var l=[],c=$("<div class='input-group'>");c.html("<span class='input-group-btn'><button type='button' class='btn btn-default btn-expand'><i class='fa fa-plus'></i></button></span><input type='text' class='form-control'><span class='input-group-btn'><button class='btn blue btn-query' type='button'><i class='fa fa-search'></i></button></span>"),r.hasClass("treeSelect")?r.before(c):r.parent().before(c);var h=c.find("input");h.on("keyup",function(e){(e.keyCode==13||e.keyCode==8&&this.value.length==0)&&v()}),c.find("button.btn-query").on("click",v),c.on("click",".btn-expand",function(){$(this).removeClass("btn-expand").addClass("btn-collapse"),$(this).children("i").removeClass("fa-plus").addClass("fa-minus"),f.expandAll(!0)}),c.on("click",".btn-collapse",function(){$(this).removeClass("btn-collapse").addClass("btn-expand"),$(this).children("i").removeClass("fa-minus").addClass("fa-plus"),f.expandAll(!1)});function p(e){for(var t=0,n=l.length;t<n;t++)l[t].highlight=e,f.updateNode(l[t]),e&&d(l[t])}function d(e){var t=e.getParentNode();t!=null&&(f.expandNode(t,!0,!1,!0),d(t))}function v(){var e=$.trim(h.val());e!=""?(p(!1),l=f.getNodesByParamFuzzy("name",e),p(!0)):p(!1)}}return typeof n=="function"&&n.call(this,f),f}});