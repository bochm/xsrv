/*! Select for DataTables 1.2.0
 * 2015-2016 SpryMedia Ltd - datatables.net/license/mit
 */

/**
 * @summary     Select for DataTables
 * @description A collection of API methods, events and buttons for DataTables
 *   that provides selection options of the items in a DataTable
 * @version     1.2.0
 * @file        dataTables.select.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     datatables.net/forums
 * @copyright   Copyright 2015-2016 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net/extensions/select
 */

(function(e){typeof define=="function"&&define.amd?define(["jquery","datatables.net"],function(t){return e(t,window,document)}):typeof exports=="object"?module.exports=function(t,n){t||(t=window);if(!n||!n.fn.dataTable)n=require("datatables.net")(t,n).$;return e(n,t,t.document)}:e(jQuery,window,document)})(function(e,t,n,r){"use strict";function s(e,t,n){var r,i,s,o=function(t,n){if(t>n){var r=n;n=t,t=r}var i=!1;return e.columns(":visible").indexes().filter(function(e){return e===t&&(i=!0),e===n?(i=!1,!0):i})},u=function(t,n){var r=e.rows({search:"applied"}).indexes();if(r.indexOf(t)>r.indexOf(n)){var i=n;n=t,t=i}var s=!1;return r.filter(function(e){return e===t&&(s=!0),e===n?(s=!1,!0):s})};!e.cells({selected:!0}).any()&&!n?(i=o(0,t.column),s=u(0,t.row)):(i=o(n.column,t.column),s=u(n.row,t.row)),r=e.cells(s,i).flatten(),e.cells(t,{selected:!0}).any()?e.cells(r).deselect():e.cells(r).select()}function o(t){var n=t.settings()[0],r=n._select.selector;e(t.table().body()).off("mousedown.dtSelect",r).off("mouseup.dtSelect",r).off("click.dtSelect",r),e("body").off("click.dtSelect")}function u(n){var r=e(n.table().body()),i=n.settings()[0],s=i._select.selector;r.on("mousedown.dtSelect",s,function(e){(e.shiftKey||e.metaKey||e.ctrlKey)&&r.css("-moz-user-select","none").one("selectstart.dtSelect",s,function(){return!1})}).on("mouseup.dtSelect",s,function(){r.css("-moz-user-select","")}).on("click.dtSelect",s,function(r){var i=n.select.items(),s;if(t.getSelection&&t.getSelection().toString())return;var o=n.settings()[0];if(e(r.target).closest("div.dataTables_wrapper")[0]!=n.table().container())return;var u=n.cell(e(r.target).closest("td, th"));if(!u.any())return;var f=e.Event("user-select.dt");a(n,f,[i,u,r]);if(f.isDefaultPrevented())return;var l=u.index();i==="row"?(s=l.row,p(r,n,o,"row",s)):i==="column"?(s=u.index().column,p(r,n,o,"column",s)):i==="cell"&&(s=u.index(),p(r,n,o,"cell",s)),o._select_lastCell=l}),e("body").on("click.dtSelect",function(t){if(i._select.blurable){if(e(t.target).parents().filter(n.table().container()).length)return;if(e(t.target).parents("div.DTE").length)return;h(i,!0)}})}function a(t,n,r,i){if(i&&!t.flatten().length)return;typeof n=="string"&&(n+=".dt"),r.unshift(t),e(t.table().node()).triggerHandler(n,r)}function f(t){var n=t.settings()[0];if(!n._select.info||!n.aanFeatures.i)return;var r=e('<span class="select-info"/>'),i=function(n,i){r.append(e('<span class="select-item"/>').append(t.i18n("select."+n+"s",{_:"%d "+n+"s selected",0:"",1:"1 "+n+" selected"},i)))};i("row",t.rows({selected:!0}).flatten().length),i("column",t.columns({selected:!0}).flatten().length),i("cell",t.cells({selected:!0}).flatten().length),e.each(n.aanFeatures.i,function(t,n){n=e(n);var i=n.children("span.select-info");i.length&&i.remove(),r.text()!==""&&n.append(r)})}function l(t){var n=new i.Api(t);t.aoRowCreatedCallback.push({fn:function(n,r,i){var s,o,u=t.aoData[i];u._select_selected&&e(n).addClass(t._select.className);for(s=0,o=t.aoColumns.length;s<o;s++)(t.aoColumns[s]._select_selected||u._selected_cells&&u._selected_cells[s])&&e(u.anCells[s]).addClass(t._select.className)},sName:"select-deferRender"}),n.on("preXhr.dt.dtSelect",function(){var e=n.rows({selected:!0}).ids(!0).filter(function(e){return e!==r}),t=n.cells({selected:!0}).eq(0).map(function(e){var t=n.row(e.row).id(!0);return t?{row:t,column:e.column}:r}).filter(function(e){return e!==r});n.one("draw.dt.dtSelect",function(){n.rows(e).select(),t.any()&&t.each(function(e){n.cells(e.row,e.column).select()})})}),n.on("draw.dtSelect.dt select.dtSelect.dt deselect.dtSelect.dt info.dt",function(){f(n)}),n.on("destroy.dtSelect",function(){o(n),n.off(".dtSelect")})}function c(t,n,r,i){var s=t[n+"s"]({search:"applied"}).indexes(),o=e.inArray(i,s),u=e.inArray(r,s);if(!t[n+"s"]({selected:!0}).any()&&o===-1)s.splice(e.inArray(r,s)+1,s.length);else{if(o>u){var a=u;u=o,o=a}s.splice(u+1,s.length),s.splice(0,o)}t[n](r,{selected:!0}).any()?(s.splice(e.inArray(r,s),1),t[n+"s"](s).deselect()):t[n+"s"](s).select()}function h(e,t){if(t||e._select.style==="single"){var n=new i.Api(e);n.rows({selected:!0}).deselect(),n.columns({selected:!0}).deselect(),n.cells({selected:!0}).deselect()}}function p(e,t,n,r,i){var o=t.select.style(),u=t[r](i,{selected:!0}).any();if(o==="os")if(e.ctrlKey||e.metaKey)t[r](i).select(!u);else if(e.shiftKey)r==="cell"?s(t,i,n._select_lastCell||null):c(t,r,i,n._select_lastCell?n._select_lastCell[r]:null);else{var a=t[r+"s"]({selected:!0});u&&a.flatten().length===1?t[r](i).deselect():(a.deselect(),t[r](i).select())}else o=="multi+shift"?e.shiftKey?r==="cell"?s(t,i,n._select_lastCell||null):c(t,r,i,n._select_lastCell?n._select_lastCell[r]:null):t[r](i).select(!u):t[r](i).select(!u)}function m(e,t){return function(n){return n.i18n("buttons."+e,t)}}var i=e.fn.dataTable;i.select={},i.select.version="1.2.0",i.select.init=function(t){var n=t.settings()[0],s=n.oInit.select,o=i.defaults.select,u=s===r?o:s,a="row",f="api",l=!1,c=!0,h="td, th",p="selected";n._select={},u===!0?f="os":typeof u=="string"?f=u:e.isPlainObject(u)&&(u.blurable!==r&&(l=u.blurable),u.info!==r&&(c=u.info),u.items!==r&&(a=u.items),u.style!==r&&(f=u.style),u.selector!==r&&(h=u.selector),u.className!==r&&(p=u.className)),t.select.selector(h),t.select.items(a),t.select.style(f),t.select.blurable(l),t.select.info(c),n._select.className=p,e.fn.dataTable.ext.order["select-checkbox"]=function(t,n){return this.api().column(n,{order:"index"}).nodes().map(function(n){return t._select.items==="row"?e(n).parent().hasClass(t._select.className):t._select.items==="cell"?e(n).hasClass(t._select.className):!1})},e(t.table().node()).hasClass("selectable")&&t.select.style("os")},e.each([{type:"row",prop:"aoData"},{type:"column",prop:"aoColumns"}],function(e,t){i.ext.selector[t.type].push(function(e,n,i){var s=n.selected,o,u=[];if(s===r)return i;for(var a=0,f=i.length;a<f;a++)o=e[t.prop][i[a]],(s===!0&&o._select_selected===!0||s===!1&&!o._select_selected)&&u.push(i[a]);return u})}),i.ext.selector.cell.push(function(e,t,n){var i=t.selected,s,o=[];if(i===r)return n;for(var u=0,a=n.length;u<a;u++)s=e.aoData[n[u].row],(i===!0&&s._selected_cells&&s._selected_cells[n[u].column]===!0||i===!1&&(!s._selected_cells||!s._selected_cells[n[u].column]))&&o.push(n[u]);return o});var d=i.Api.register,v=i.Api.registerPlural;return d("select()",function(){return this.iterator("table",function(e){i.select.init(new i.Api(e))})}),d("select.blurable()",function(e){return e===r?this.context[0]._select.blurable:this.iterator("table",function(t){t._select.blurable=e})}),d("select.info()",function(e){return f===r?this.context[0]._select.info:this.iterator("table",function(t){t._select.info=e})}),d("select.items()",function(e){return e===r?this.context[0]._select.items:this.iterator("table",function(t){t._select.items=e,a(new i.Api(t),"selectItems",[e])})}),d("select.style()",function(e){return e===r?this.context[0]._select.style:this.iterator("table",function(t){t._select.style=e,t._select_init||l(t);var n=new i.Api(t);o(n),e!=="api"&&u(n),a(new i.Api(t),"selectStyle",[e])})}),d("select.selector()",function(e){return e===r?this.context[0]._select.selector:this.iterator("table",function(t){o(new i.Api(t)),t._select.selector=e,t._select.style!=="api"&&u(new i.Api(t))})}),v("rows().select()","row().select()",function(t){var n=this;return t===!1?this.deselect():(this.iterator("row",function(t,n){h(t),t.aoData[n]._select_selected=!0,e(t.aoData[n].nTr).addClass(t._select.className)}),this.iterator("table",function(e,t){a(n,"select",["row",n[t]],!0)}),this)}),v("columns().select()","column().select()",function(t){var n=this;return t===!1?this.deselect():(this.iterator("column",function(t,n){h(t),t.aoColumns[n]._select_selected=!0;var r=(new i.Api(t)).column(n);e(r.header()).addClass(t._select.className),e(r.footer()).addClass(t._select.className),r.nodes().to$().addClass(t._select.className)}),this.iterator("table",function(e,t){a(n,"select",["column",n[t]],!0)}),this)}),v("cells().select()","cell().select()",function(t){var n=this;return t===!1?this.deselect():(this.iterator("cell",function(t,n,i){h(t);var s=t.aoData[n];s._selected_cells===r&&(s._selected_cells=[]),s._selected_cells[i]=!0,s.anCells&&e(s.anCells[i]).addClass(t._select.className)}),this.iterator("table",function(e,t){a(n,"select",["cell",n[t]],!0)}),this)}),v("rows().deselect()","row().deselect()",function(){var t=this;return this.iterator("row",function(t,n){t.aoData[n]._select_selected=!1,e(t.aoData[n].nTr).removeClass(t._select.className)}),this.iterator("table",function(e,n){a(t,"deselect",["row",t[n]],!0)}),this}),v("columns().deselect()","column().deselect()",function(){var t=this;return this.iterator("column",function(t,n){t.aoColumns[n]._select_selected=!1;var r=new i.Api(t),s=r.column(n);e(s.header()).removeClass(t._select.className),e(s.footer()).removeClass(t._select.className),r.cells(null,n).indexes().each(function(n){var r=t.aoData[n.row],i=r._selected_cells;r.anCells&&(!i||!i[n.column])&&e(r.anCells[n.column]).removeClass(t._select.className)})}),this.iterator("table",function(e,n){a(t,"deselect",["column",t[n]],!0)}),this}),v("cells().deselect()","cell().deselect()",function(){var t=this;return this.iterator("cell",function(t,n,r){var i=t.aoData[n];i._selected_cells[r]=!1,i.anCells&&!t.aoColumns[r]._select_selected&&e(i.anCells[r]).removeClass(t._select.className)}),this.iterator("table",function(e,n){a(t,"deselect",["cell",t[n]],!0)}),this}),e.extend(i.ext.buttons,{selected:{text:m("selected","Selected"),className:"buttons-selected",init:function(e){var t=this;e.on("draw.dt.DT select.dt.DT deselect.dt.DT",function(){var e=t.rows({selected:!0}).any()||t.columns({selected:!0}).any()||t.cells({selected:!0}).any();t.enable(e)}),this.disable()}},selectedSingle:{text:m("selectedSingle","Selected single"),className:"buttons-selected-single",init:function(e){var t=this;e.on("draw.dt.DT select.dt.DT deselect.dt.DT",function(){var n=e.rows({selected:!0}).flatten().length+e.columns({selected:!0}).flatten().length+e.cells({selected:!0}).flatten().length;t.enable(n===1)}),this.disable()}},selectAll:{text:m("selectAll","Select all"),className:"buttons-select-all",action:function(){var e=this.select.items();this[e+"s"]().select()}},selectNone:{text:m("selectNone","Deselect all"),className:"buttons-select-none",action:function(){h(this.settings()[0],!0)},init:function(e){var t=this;e.on("draw.dt.DT select.dt.DT deselect.dt.DT",function(){var n=e.rows({selected:!0}).flatten().length+e.columns({selected:!0}).flatten().length+e.cells({selected:!0}).flatten().length;t.enable(n>0)}),this.disable()}}}),e.each(["Row","Column","Cell"],function(e,t){var n=t.toLowerCase();i.ext.buttons["select"+t+"s"]={text:m("select"+t+"s","Select "+n+"s"),className:"buttons-select-"+n+"s",action:function(){this.select.items(n)},init:function(e){var t=this;e.on("selectItems.dt.DT",function(e,r,i){t.active(i===n)})}}}),e(n).on("preInit.dt.dtSelect",function(e,t){if(e.namespace!=="dt")return;i.select.init(new i.Api(t))}),i.select});