define("module/weixin/gift",["app/common","app/datatables","app/form"],function(e,t,n){var r={table:{id:"#table-weixin-gift-list",options:{title:"\u793c\u54c1\u8868",columns:[{data:"id",title:"id",visible:!1},{data:"giftId",title:"giftId",visible:!1},{data:"giftName",title:"\u793c\u54c1\u540d\u79f0"},{data:"price",title:"\u5355\u4ef7"},{data:"unit",title:"\u5355\u4f4d"},{data:"exchangeScore",title:"\u5151\u6362\u79ef\u5206"},{data:"stock",title:"\u5e93\u5b58",render:function(e,t,n,r){return"<a href='#' data-view='"+r.row+"'>"+e+"</a>"}},{data:"sale",title:"\u662f\u5426\u4e0a\u67b6",render:function(e,t,n,r){return e=="1"?"\u662f":"\u5426"},width:"12%"}],ordering:!1,deleteRecord:{url:"WEIXIN/gift/deleteBatch",row:!0,id:"id"},addEditForm:{title:"\u793c\u54c1\u7ef4\u62a4",editModal:"#weixin-gift-edit-modal",id:"#weixin-gift-edit-form",addUrl:"WEIXIN/gift/add",editUrl:"WEIXIN/gift/update",submitJson:!0,fieldOpts:{picture:{fileServer:"WEIXIN",param:{type:"gift"},maxFiles:2,col:4,savePath:!0}}}}},init:function(t){this.table.options.params=t||{},this.table.options.addEditForm.submitCallback=function(e){r.table.obj.query()},$(this.table.id).initTable(this.table.options,function(e){r.table.obj=e}),$(this.table.id).on("click","a[data-view]",function(){var t=r.table.obj.row($(this).data("view")).data();e.modal("#weixin-gift-stock-modal",{url:"pages/weixin/gift/gift-stock",params:{giftId:t.id},title:"\u793c\u54c1\u8d2d\u8fdb\u660e\u7ec6"})})}},i={table:{id:"#table-weixin-gift-stock",options:{title:"\u793c\u54c1\u8d2d\u8fdb\u8868",columns:[{data:"applyNo",title:"\u8d2d\u8fdb\u5355\u53f7"},{data:"purchaseDate",title:"\u8d2d\u8fdb\u65e5\u671f"},{data:"qtyPurchase",title:"\u6570\u91cf"},{data:"amount",title:"\u91d1\u989d"}]}},init:function(e){this.table.options.dataUrl="WEIXIN/giftpurchase/selectDetail",this.table.options.params=e,$(this.table.id).initTable(this.table.options)}},s={table:{id:"#table-weixin-gift-purchase",options:{title:"\u793c\u54c1\u8d2d\u8fdb",columns:[{data:"id",visible:!1},{data:"purchaseDetail",visible:!1},{data:"applyNo",title:"\u8d2d\u8fdb\u5355\u53f7"},{data:"applyDate",title:"\u8d2d\u8fdb\u65e5\u671f"},{data:"amount",title:"\u91d1\u989d"},{data:"qtyPurchase",title:"\u6570\u91cf"}],ordering:!1,deleteRecord:{url:"WEIXIN/giftpurchase/deleteBatch",row:!0,id:"id"},addRecord:function(t,n,r){e.loadInnerPage(e.getPageContainer("#table-weixin-gift-purchase"),"pages/weixin/gift/gift-purchase-edit",{act:"add"})},editRecord:function(t,n,r){e.loadInnerPage(e.getPageContainer("#table-weixin-gift-purchase"),"pages/weixin/gift/gift-purchase-edit",{act:"update",formData:t.selectedRowsData()[0]})}}},init:function(e){this.table.options.params=e||{},this.table.options.deleteRecord.onDeleted=function(){t.getTable(r.table.id).query()},$(this.table.id).initTable(this.table.options,function(e){s.table.obj=e})}},o={table:{id:"#table-weixin-gift-purchase-detail",options:{title:"\u793c\u54c1\u8d2d\u8fdb",dataUrl:"WEIXIN/giftpurchase/selectDetail",columns:[{data:"id",visible:!1},{data:"applyId",visible:!1},{data:"applyNo",visible:!1},{data:"giftId",visible:!1},{data:"giftName",title:"\u793c\u54c1\u540d\u79f0"},{data:"price",title:"\u4ef7\u683c"},{data:"unit",title:"\u5355\u4f4d"},{data:"qtyPurchase",title:"\u6570\u91cf"},{data:"amount",title:"\u91d1\u989d"}],rowOperation:["edit","delete"],ordering:!1,paging:!1,addEditForm:{title:"\u793c\u54c1\u8d2d\u8fdb\u660e\u7ec6",editModal:"#weixin-gift-purchase-detail-edit-modal",id:"#weixin-gift-purchase-detail-form",fieldOpts:{giftId:{dataUrl:"WEIXIN//gift/listGift",textProperty:"giftName"}}}}},form:{id:"#weixin-gift-purchase-form",submitJson:!0,autoClose:!0},init:function(n){n.act=="add"?(this.table.options.params={id:-1},this.form.formData=null,this.form.submitClear=!0,this.form.url="WEIXIN/giftpurchase/insert"):n.act=="update"&&(this.table.options.params={applyId:n.formData.id},this.form.formData=n.formData,this.form.submitClear=!1,this.form.url="WEIXIN/giftpurchase/update");var i=$(this.form.id),u=$(this.table.options.addEditForm.id);this.form.initComplete=function(e){i.field("companyId").val(API.localUser().company_id),i.field("deptId").val(API.localUser().dept_id)},$(this.form.id).initForm(this.form,function(e){t.getTable(s.table.id).query(),t.getTable(r.table.id).query()}),o.table.options.addEditForm.initComplete=function(e){var n=t.getTable(o.table.id).columnData("giftId"),r=u.field("giftId").data("options");for(var i=0;i<r.length;i++)$.inArray(r[i].id,n)>=0?r[i].disabled=!0:r[i].disabled=!1;u.field("giftId").empty(),u.field("giftId").select({data:r})},$(this.table.id).initTable(this.table.options,function(e){o.table.obj=e}),$(this.table.id).on("draw.dt",function(){o.table.obj!==undefined&&(i.field("qtyPurchase").val(o.table.obj.columnData("qtyPurchase").sum()),i.field("amount").val(o.table.obj.columnData("amount").sum()))}),u.on("select2:select","[name='giftId']",function(){var e=$(this).select2("data")[0];u.field("giftName").val(e.giftName),u.field("price").val(e.price),u.field("unit").val(e.unit)}),u.on("change","[name='qtyPurchase']",function(){e.isEmpty(u.field("price").val())||u.field("amount").val(e.numeral(u.field("price").val()).multiply($(this).val()).format("0.00"))})}};return{initPurchase:function(e){s.init(e)},initPurchaseEdit:function(e){o.init(e)},init:function(e){r.init(e)},initGiftStock:function(e){i.init(e)}}});