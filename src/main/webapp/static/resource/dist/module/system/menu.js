define("module/system/menu",["app/common","app/api","app/treetable","app/form"],function(e,t,n,r){function o(n){$("table#table-system-menu-list").treetable({tid:"id",tpid:"parentId",expandable:!0,expandBtn:!0,columns:i,columnDefs:s,buttons:["addRecord","editRecord","deleteRecord"],addEditModal:{url:"pages/system/menu/menu-edit",id:"#system-menu-edit",title:"\u83dc\u5355\u7ef4\u62a4"},deleteRecord:function(n,r,i){e.confirm("","\u662f\u5426\u5220\u9664\u9009\u62e9\u7684\u83dc\u5355\u53ca\u5305\u542b\u7684\u6240\u6709\u5b50\u83dc\u5355?",function(){t.ajax("ADMIN/system/menu/delete",n.selectedColumnData("id"),null,function(r,i){t.isError(r)?e.error(t.respMsg(r)):(n.deleteSelectedRow(),e.success(t.respMsg(r)))})})}},function(e){menuTable=e})}function u(e){if(!e.id&&!e.icons)return e.text;var t=e.icons?e.icons:e.id;return $("<span align='left'><i class='"+t+"'></i>&nbsp;"+e.text+"</span>")}function a(e){var t=e.table;$("#system-menu-edit-form input[name='type']").on("switch:change",function(e,t){t?($("#system-menu-edit-form input[name='permission']").addClass("required"),$("#system-menu-edit-form select[name='icon']").removeClass("required selectOpt")):($("#system-menu-edit-form input[name='permission']").removeClass("required"),$("#system-menu-edit-form select[name='icon']").addClass("required selectOpt"))});var n=e.act,r={validate:{},submitClear:!0,url:"ADMIN/system/menu/"+n,fieldOpts:{icon:{templateResult:u,templateSelection:u},parentMenuName:{view:{selectedMulti:!1},queryTools:!0}},onSuccess:function(e){$.fn.zTree.getZTreeObj("system_menu_forms_parentTree").reAsyncChildNodes(null,"refresh"),t.addRow(e)}};n=="edit"&&(r.formData=t.selectedRows()[0],r.submitClear=!1,r.fieldOpts.parentMenuName.param={parentMenu:r.formData.id},r.onSuccess=function(e){$.fn.zTree.getZTreeObj("system_menu_forms_parentTree").reAsyncChildNodes(null,"refresh"),t.updateSelectedRow(e)}),$("#system-menu-edit-form").initForm(r)}var i=[{data:"id",visible:!1},{data:"parentId",visible:!1},{data:"name",title:"\u83dc\u5355\u540d\u79f0",width:"30%"},{data:"icon",title:"\u56fe\u6807",width:"7%"},{data:"target",title:"\u94fe\u63a5",width:"30%"},{data:"permission",title:"\u6743\u9650"},{data:"status",title:"\u72b6\u6001",width:"8%",render:function(e){return t.getDictName("on_off",e)}}],s=[{targets:2,render:function(e,t,n){return n.type=="1"?"<i class='fa fa-pencil-square-o'></i> "+e:n.target=="#"?"<i class='fa fa-cog'></i> "+e:"<i class='fa fa-link'></i> "+e}},{targets:3,render:function(e,t,n){return"<i class='"+e+"'></i>"}}];return{inti_table:o,handleEdit:a,init:function(e){this.inti_table(e)}}});