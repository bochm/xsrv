<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.bx.demo.mapper.ClassesMapper"> 
	<!-- <resultMap id="classesMap" type="cn.bx.demo.entity.Classes">
		<id column="id" property="id"/>
		<result column="class_name" property="className"/>
		<result column="class_master" property="classMaster"/>
		<collection property="students" ofType="cn.bx.demo.entity.Student" javaType="list" notNullColumn="student_id">
			<id column="student_id" property="id"/>
			<result column="class_id" property="classId"/>
			<result column="student_name" property="name"/>
			<result column="student_age" property="age"/>
		</collection>
	</resultMap> -->
    <!-- <sql id="classesColumns">
    	a.id,a.class_name,a.class_master,b.id "student_id",a.id "class_id",b.name "student_name",b.age "student_age"
    </sql> -->
    <sql id="classesColumns">
    	a.id,a.class_name,a.class_master,b.student_count
    </sql>
    <sql id="joins">
    	left join (select class_id,count(id) student_count from test_student group by class_id) b on b.class_id = a.id
    </sql>
	<select id="listClasses" resultType="cn.bx.demo.entity.Classes">
		select <include refid="classesColumns"/> from test_classes a
		<include refid="joins"/>
		<trim prefix="where" prefixOverrides="and">
			<if test="className != null and className != ''">
			a.class_name = #{className}
			</if>
			<if test="classMaster != null and classMaster != ''">
			and a.class_master &lt; #{classMaster}
			</if>
		</trim>
	</select>
	<insert id="addUser">
		insert into sys_user(id, company_id, dept_id, login_name, password, no, name, email, phone, 
		mobile, user_type, create_by, create_date, update_by, update_date, remarks, login_flag, photo,status) 
		values (#{id}, #{company.id},#{dept.id} ,#{loginName}, #{password}, #{no}, #{name}, #{email}, #{tel}, 
		#{mobile}, #{userType}, #{createBy}, #{createDate}, #{updateBy}, #{updateDate}, #{remarks}, 
		#{loginFlag}, #{photo},#{status})
	</insert>
	
	<update id="saveUser">
		update sys_user set login_name = #{loginName}, company_id=#{company.id},dept_id=#{dept.id},
		<if test="password != null and password != ''">
		password = #{password}, 
		</if>
		no = #{no}, name = #{name}, email = #{email}, phone = #{tel}, mobile = #{mobile}, 
		user_type = #{userType}, update_by = #{updateBy}, update_date = #{updateDate}, 
		login_flag = #{loginFlag},photo = #{photo},remarks = #{remarks},status = #{status}
		where id = #{id}
	</update>
	
	<delete id="deleteUser">
		delete from  sys_user where id in
		<foreach collection="array" item="id" open="(" close=")" separator=",">#{id}</foreach>
	</delete>
</mapper>